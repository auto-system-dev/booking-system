# 資料庫使用說明

## 📊 資料庫設定

系統使用 **SQLite** 資料庫來儲存訂房資料。

### 優點
- ✅ 不需要額外安裝資料庫伺服器
- ✅ 資料庫檔案（`bookings.db`）會自動建立
- ✅ 輕量級，適合中小型應用
- ✅ 所有資料儲存在單一檔案中

## 🚀 安裝與啟動

### 1. 安裝資料庫套件

```powershell
& "C:\Program Files\nodejs\npm.cmd" install
```

這會安裝 `sqlite3` 套件。

### 2. 啟動伺服器

伺服器啟動時會自動：
- 建立資料庫檔案（如果不存在）
- 建立資料表結構
- 準備好接收訂房資料

```powershell
& "C:\Program Files\nodejs\node.exe" server.js
```

或使用批次檔：
- 雙擊 `快速啟動.bat`

## 📋 資料表結構

### bookings 資料表

| 欄位名稱 | 類型 | 說明 |
|---------|------|------|
| id | INTEGER | 主鍵（自動遞增） |
| booking_id | TEXT | 訂房編號（唯一） |
| check_in_date | TEXT | 入住日期 |
| check_out_date | TEXT | 退房日期 |
| room_type | TEXT | 房型 |
| guest_name | TEXT | 客戶姓名 |
| guest_phone | TEXT | 客戶電話 |
| guest_email | TEXT | 客戶 Email |
| payment_amount | TEXT | 支付金額類型（訂金/全額） |
| payment_method | TEXT | 付款方式（匯款/刷卡） |
| price_per_night | INTEGER | 每晚房價 |
| nights | INTEGER | 住宿天數 |
| total_amount | INTEGER | 總金額 |
| final_amount | INTEGER | 應付金額 |
| booking_date | TEXT | 訂房日期時間 |
| email_sent | INTEGER | 郵件是否已發送（0/1） |
| created_at | DATETIME | 建立時間（自動） |

## 🔌 API 端點

### 1. 查詢所有訂房記錄

```
GET /api/bookings
```

**回應範例：**
```json
{
  "success": true,
  "count": 5,
  "data": [
    {
      "id": 1,
      "booking_id": "BK1765202639511",
      "guest_name": "邱建程",
      ...
    }
  ]
}
```

### 2. 根據訂房編號查詢

```
GET /api/bookings/:bookingId
```

**範例：**
```
GET /api/bookings/BK1765202639511
```

### 3. 根據 Email 查詢

```
GET /api/bookings/email/:email
```

**範例：**
```
GET /api/bookings/email/cheng701107@gmail.com
```

### 4. 取得統計資料

```
GET /api/statistics
```

**回應範例：**
```json
{
  "success": true,
  "data": {
    "totalBookings": 10,
    "totalRevenue": 50000,
    "byRoomType": [
      {"room_type": "標準雙人房", "count": 5},
      {"room_type": "豪華雙人房", "count": 3}
    ],
    "recentBookings": 3
  }
}
```

## 📁 資料庫檔案位置

資料庫檔案會自動建立在專案根目錄：
```
程式開發/
  └── bookings.db
```

## 🔍 查看資料庫內容

### 方法一：使用 SQLite 命令列工具

1. 下載 SQLite：https://www.sqlite.org/download.html
2. 執行：
   ```bash
   sqlite3 bookings.db
   .tables          # 查看所有資料表
   SELECT * FROM bookings;  # 查看所有訂房記錄
   ```

### 方法二：使用瀏覽器擴充功能

- SQLite Viewer（Chrome 擴充功能）
- 或使用線上工具：https://sqliteviewer.app/

### 方法三：使用 API

訪問：http://localhost:3000/api/bookings

## 🛠️ 資料庫維護

### 備份資料庫

```powershell
# 複製 bookings.db 檔案
Copy-Item bookings.db bookings_backup.db
```

### 重置資料庫

```powershell
# 刪除資料庫檔案（會重新建立）
Remove-Item bookings.db
# 重新啟動伺服器
```

## 📊 資料庫功能

系統會自動：
- ✅ 儲存每筆訂房記錄
- ✅ 記錄郵件發送狀態
- ✅ 自動建立時間戳記
- ✅ 防止重複的訂房編號

## 🔄 升級到其他資料庫

如果需要使用 MySQL 或 PostgreSQL：

1. 安裝對應的套件（如 `mysql2` 或 `pg`）
2. 修改 `database.js` 中的連線設定
3. 調整 SQL 語法（如有需要）

## 💡 注意事項

- 資料庫檔案（`bookings.db`）應該加入版本控制（.gitignore）
- 定期備份資料庫檔案
- 生產環境建議使用 MySQL 或 PostgreSQL

