# Railway 部署檢查清單

## ✅ 部署前準備

### 1. 環境變數準備
請準備以下環境變數的值（稍後在 Railway 中設定）：

- **EMAIL_USER**: 您的 Gmail 帳號（例如：your-email@gmail.com）
- **EMAIL_PASS**: Gmail 應用程式密碼（16 字元，不是一般密碼）
- **ECPAY_MERCHANT_ID**: 綠界商店代號（可選）
- **ECPAY_HASH_KEY**: 綠界金鑰（可選）
- **ECPAY_HASH_IV**: 綠界向量（可選）

> **注意**：`DATABASE_URL` 會由 Railway 自動提供，不需要手動設定。

### 2. Gmail 應用程式密碼設定
1. 前往 [Google 帳號設定](https://myaccount.google.com/)
2. 點擊「安全性」
3. 啟用「兩步驟驗證」（如果還沒啟用）
4. 在「應用程式密碼」中建立新密碼
5. 選擇「郵件」和「其他（自訂名稱）」（例如：Railway）
6. 複製產生的 16 字元密碼（格式：xxxx xxxx xxxx xxxx）

---

## 🚀 部署步驟

### 步驟 1：安裝 Git（如果還沒安裝）

1. 下載 Git：https://git-scm.com/download/win
2. 安裝完成後，重新開啟終端機

### 步驟 2：初始化 Git 並推送到 GitHub

```powershell
# 1. 初始化 Git
git init

# 2. 加入所有檔案
git add .

# 3. 建立第一次提交
git commit -m "Initial commit: 訂房系統 Railway 部署版本"

# 4. 在 GitHub 建立新儲存庫
#    - 前往 https://github.com/new
#    - 輸入儲存庫名稱（例如：booking-system）
#    - 選擇 Public 或 Private
#    - 不要勾選「Initialize this repository with a README」
#    - 點擊「Create repository」

# 5. 連接遠端儲存庫（將 YOUR_USERNAME 和 REPO_NAME 替換為您的資訊）
git remote add origin https://github.com/YOUR_USERNAME/REPO_NAME.git

# 6. 推送到 GitHub
git branch -M main
git push -u origin main
```

### 步驟 3：在 Railway 建立專案

1. **登入 Railway**
   - 前往 https://railway.app
   - 點擊「Login」→ 選擇「Login with GitHub」
   - 授權 Railway 存取您的 GitHub 帳號

2. **建立新專案**
   - 點擊「New Project」
   - 選擇「Deploy from GitHub repo」
   - 選擇您剛才建立的儲存庫
   - Railway 會自動開始部署

3. **新增 PostgreSQL 資料庫**
   - 在專案中點擊「+ New」
   - 選擇「Database」→「Add PostgreSQL」
   - Railway 會自動建立 PostgreSQL 資料庫
   - **重要**：Railway 會自動將 `DATABASE_URL` 環境變數加入到您的應用程式

### 步驟 4：設定環境變數

1. 在 Railway 專案中，點擊您的應用程式（不是資料庫）
2. 點擊「Variables」標籤
3. 新增以下環境變數：

   | 變數名稱 | 值 | 說明 |
   |---------|-----|------|
   | EMAIL_USER | your-email@gmail.com | 您的 Gmail 帳號 |
   | EMAIL_PASS | xxxx xxxx xxxx xxxx | Gmail 應用程式密碼 |
   | ECPAY_MERCHANT_ID | (可選) | 綠界商店代號 |
   | ECPAY_HASH_KEY | (可選) | 綠界金鑰 |
   | ECPAY_HASH_IV | (可選) | 綠界向量 |

   > **注意**：`DATABASE_URL` 和 `PORT` 會由 Railway 自動設定，不需要手動新增。

4. 點擊「Add」儲存每個環境變數

### 步驟 5：檢查部署狀態

1. **查看部署日誌**
   - 在 Railway 專案中，點擊「Deployments」標籤
   - 查看最新的部署日誌
   - 確認沒有錯誤訊息

2. **取得應用程式網址**
   - 在 Railway 專案中，點擊您的應用程式
   - 點擊「Settings」標籤
   - 在「Domains」區塊，點擊「Generate Domain」
   - Railway 會產生一個網址（例如：`https://your-app.up.railway.app`）

3. **測試應用程式**
   - 訪問產生的網址
   - 確認首頁正常顯示
   - 測試訂房功能
   - 測試管理後台（`/admin`）

---

## 🔍 常見問題排查

### 問題 1：部署失敗

**檢查項目：**
- 查看 Railway 部署日誌中的錯誤訊息
- 確認 `package.json` 中的依賴套件正確
- 確認 `server.js` 可以正常啟動

**解決方法：**
- 檢查日誌中的具體錯誤
- 確認所有環境變數已正確設定
- 確認 PostgreSQL 資料庫已正確連接

### 問題 2：資料庫連線失敗

**檢查項目：**
- 確認 PostgreSQL 服務已在 Railway 中建立
- 確認 `DATABASE_URL` 環境變數已自動設定
- 查看應用程式日誌中的資料庫連線訊息

**解決方法：**
- 在 Railway 中重新建立 PostgreSQL 資料庫
- 確認應用程式和資料庫在同一個專案中

### 問題 3：郵件發送失敗

**檢查項目：**
- 確認 `EMAIL_USER` 和 `EMAIL_PASS` 已正確設定
- 確認使用的是「應用程式密碼」而非一般密碼
- 確認 Gmail 帳號已啟用「兩步驟驗證」

**解決方法：**
- 重新產生 Gmail 應用程式密碼
- 確認環境變數中的值沒有多餘的空格

### 問題 4：無法訪問應用程式

**檢查項目：**
- 確認已產生網域（Domain）
- 確認應用程式正在運行（Status 為 Running）

**解決方法：**
- 在 Settings 中重新產生網域
- 檢查部署日誌確認應用程式已成功啟動

---

## 📝 後續維護

### 更新部署

每次修改程式碼後，推送到 GitHub 即可自動部署：

```powershell
git add .
git commit -m "更新說明"
git push
```

Railway 會自動偵測變更並重新部署。

### 查看日誌

在 Railway 專案中：
- 點擊應用程式 →「Deployments」→ 選擇部署 → 查看日誌
- 或點擊「Logs」標籤查看即時日誌

### 備份資料庫

1. 在 Railway 專案中，點擊 PostgreSQL 服務
2. 點擊「Backups」標籤
3. 可以手動建立備份或設定自動備份

---

## ✅ 部署完成檢查清單

- [ ] Git 已安裝並初始化
- [ ] 程式碼已推送到 GitHub
- [ ] Railway 專案已建立
- [ ] PostgreSQL 資料庫已建立
- [ ] 環境變數已設定（EMAIL_USER, EMAIL_PASS）
- [ ] 應用程式已成功部署
- [ ] 網域已產生
- [ ] 首頁可以正常訪問
- [ ] 訂房功能可以正常使用
- [ ] 管理後台可以正常訪問
- [ ] 郵件發送功能正常

---

## 🎉 完成！

部署完成後，您的訂房系統就可以在網路上運作了！

**重要提醒：**
- 定期備份資料庫
- 監控 Railway 使用量（免費方案每月 $5 額度）
- 保護環境變數安全（不要分享給他人）

