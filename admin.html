<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>訂房系統管理後台</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- Quill 富文本編輯器 -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
</head>
<body>
    <!-- 登入頁面 -->
    <div id="loginPage" class="login-page" style="display: flex;">
        <div class="login-container">
            <div class="login-box">
                <div class="login-box-header">
                    <h2>管理後台登入</h2>
                    <p class="subtitle">登入以管理訂房系統</p>
                </div>
                <form id="loginForm" method="POST" action="javascript:void(0)">
                    <div class="form-group">
                        <label>帳號</label>
                        <input type="text" id="loginUsername" name="username" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label>密碼</label>
                        <input type="password" id="loginPassword" name="password" required autocomplete="current-password">
                    </div>
                    <div id="loginError" class="error-message" style="display: none;"></div>
                    <button type="submit" class="btn-primary" style="width: 100%; margin-top: 20px;">登入</button>
                </form>
            </div>
        </div>
    </div>

    <!-- 管理後台主頁面 -->
    <div id="adminPage" class="admin-container" style="display: none;">
        <!-- 手機版選單按鈕 -->
        <button class="mobile-menu-btn" onclick="toggleMobileSidebar()">
            <span class="material-symbols-outlined">menu</span>
        </button>
        
        <!-- 側邊欄遮罩 -->
        <div class="sidebar-overlay" onclick="toggleMobileSidebar()"></div>
        
        <!-- 側邊欄 -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>管理後台</h1>
            </div>
            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active permission-required" data-section="dashboard" data-permission="dashboard.view" onclick="handleNavClick(event, 'dashboard')">
                    <span class="nav-icon"><span class="material-symbols-outlined">speed</span></span>
                    <span>儀表板</span>
                </a>
                <a href="#bookings" class="nav-item permission-required" data-section="bookings" data-permission="bookings.view" onclick="handleNavClick(event, 'bookings')">
                    <span class="nav-icon"><span class="material-symbols-outlined">event_note</span></span>
                    <span>訂房記錄</span>
                </a>
                <a href="#customers" class="nav-item permission-required" data-section="customers" data-permission="customers.view" onclick="handleNavClick(event, 'customers')">
                    <span class="nav-icon"><span class="material-symbols-outlined">people</span></span>
                    <span>客戶管理</span>
                </a>
                <a href="#room-types" class="nav-item permission-required" data-section="room-types" data-permission="room_types.view" onclick="handleNavClick(event, 'room-types')">
                    <span class="nav-icon"><span class="material-symbols-outlined">king_bed</span></span>
                    <span>房型管理</span>
                </a>
                <a href="#addons" class="nav-item permission-required" data-section="addons" data-permission="addons.view" onclick="handleNavClick(event, 'addons')">
                    <span class="nav-icon"><span class="material-symbols-outlined">add_shopping_cart</span></span>
                    <span>加購商品</span>
                </a>
                <a href="#promo-codes" class="nav-item permission-required" data-section="promo-codes" data-permission="promo_codes.view" onclick="handleNavClick(event, 'promo-codes')">
                    <span class="nav-icon"><span class="material-symbols-outlined">local_offer</span></span>
                    <span>優惠代碼</span>
                </a>
                <a href="#early-bird" class="nav-item permission-required" data-section="early-bird" data-permission="promo_codes.view" onclick="handleNavClick(event, 'early-bird')">
                    <span class="nav-icon"><span class="material-symbols-outlined">nest_eco_leaf</span></span>
                    <span>早鳥優惠</span>
                </a>
                <a href="#settings" class="nav-item permission-required" data-section="settings" data-permission="settings.view" onclick="handleNavClick(event, 'settings')">
                    <span class="nav-icon"><span class="material-symbols-outlined">settings</span></span>
                    <span>系統設定</span>
                </a>
                <a href="#email-templates" class="nav-item permission-required" data-section="email-templates" data-permission="email_templates.view" onclick="handleNavClick(event, 'email-templates')">
                    <span class="nav-icon"><span class="material-symbols-outlined">mail</span></span>
                    <span>郵件模板</span>
                </a>
                <a href="#statistics" class="nav-item permission-required" data-section="statistics" data-permission="statistics.view" onclick="handleNavClick(event, 'statistics')">
                    <span class="nav-icon"><span class="material-symbols-outlined">monitoring</span></span>
                    <span>統計資料</span>
                </a>
                <!-- 權限管理系統（需要相應權限才會顯示） -->
                <a href="#admin-management" class="nav-item permission-required" data-section="admin-management" data-permission="admins.view" onclick="handleNavClick(event, 'admin-management')">
                    <span class="nav-icon"><span class="material-symbols-outlined">manage_accounts</span></span>
                    <span>權限管理</span>
                </a>
                <a href="#logs" class="nav-item permission-required" data-section="logs" data-permission="logs.view" onclick="handleNavClick(event, 'logs')">
                    <span class="nav-icon"><span class="material-symbols-outlined">history</span></span>
                    <span>操作日誌</span>
                </a>
                <a href="#landing-page" class="nav-item permission-required" data-section="landing-page" data-permission="settings.view" onclick="handleNavClick(event, 'landing-page')">
                    <span class="nav-icon"><span class="material-symbols-outlined">web</span></span>
                    <span>銷售頁管理</span>
                </a>
                <a href="#backups" class="nav-item permission-required" data-section="backups" data-permission="backup.view" onclick="handleNavClick(event, 'backups')">
                    <span class="nav-icon"><span class="material-symbols-outlined">backup</span></span>
                    <span>資料備份</span>
                </a>
            </nav>
            <div class="sidebar-footer" style="margin-top: auto; padding: 20px; border-top: 1px solid #e0e0e0;">
                <div style="margin-bottom: 10px; color: #666; font-size: 14px;">
                    <span id="adminInfo">管理員：<span id="currentAdminUsername">-</span></span>
                    <br>
                    <span id="adminRole" style="font-size: 12px; color: #888;">角色：<span id="currentAdminRole">-</span></span>
                </div>
                <button class="btn-secondary" onclick="handleLogout()" style="width: 100%;">
                    <span class="material-symbols-outlined">logout</span> 登出
                </button>
            </div>
        </aside>

        <!-- 主內容區 -->
        <main class="main-content">
            <!-- 儀表板區 -->
            <section id="dashboard-section" class="content-section active">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">speed</span> 儀表板</h2>
                    <button class="btn-refresh" onclick="loadDashboard()">
                        <span class="material-symbols-outlined">refresh</span> 重新整理
                    </button>
                </div>

                <div class="dashboard-grid">
                    <!-- 今日房況卡片 -->
                    <div class="dashboard-card">
                        <div class="dashboard-card-icon"><span class="material-symbols-outlined">room_service</span></div>
                        <div class="dashboard-card-title">今日房況</div>
                        <div class="dashboard-card-subtitle">住房/退房為今日</div>
                        <div class="dashboard-card-metrics">
                            <div class="dashboard-metric">
                                <div class="dashboard-metric-label">今日住房</div>
                                <div class="dashboard-metric-value" id="todayCheckIns">0</div>
                            </div>
                            <div class="dashboard-metric">
                                <div class="dashboard-metric-label">今日退房</div>
                                <div class="dashboard-metric-value" id="todayCheckOuts">0</div>
                            </div>
                        </div>
                        <button class="dashboard-card-button" onclick="switchSection('bookings')">前往訂單列表</button>
                    </div>

                    <!-- 今日訂單卡片 -->
                    <div class="dashboard-card">
                        <div class="dashboard-card-icon"><span class="material-symbols-outlined">order_approve</span></div>
                        <div class="dashboard-card-title">今日訂單</div>
                        <div class="dashboard-card-subtitle">訂購日為今日</div>
                        <div class="dashboard-card-metrics">
                            <div class="dashboard-metric">
                                <div class="dashboard-metric-label">匯款轉帳</div>
                                <div class="dashboard-metric-value" id="todayTransferOrders">0</div>
                            </div>
                            <div class="dashboard-metric">
                                <div class="dashboard-metric-label">線上刷卡</div>
                                <div class="dashboard-metric-value" id="todayCardOrders">0</div>
                            </div>
                        </div>
                        <button class="dashboard-card-button" onclick="switchSection('bookings')">前往訂單列表</button>
                    </div>

                    <!-- 訂房狀態卡片 -->
                    <div class="dashboard-card">
                        <div class="dashboard-card-icon"><span class="material-symbols-outlined">king_bed</span></div>
                        <div class="dashboard-card-title">訂房狀態</div>
                        <div class="dashboard-card-subtitle">所有訂單狀態統計</div>
                        <div class="dashboard-card-metrics">
                            <div class="dashboard-metric">
                                <div class="dashboard-metric-label">有效</div>
                                <div class="dashboard-metric-value" id="activeBookings">0</div>
                            </div>
                            <div class="dashboard-metric">
                                <div class="dashboard-metric-label">保留</div>
                                <div class="dashboard-metric-value" id="reservedBookings">0</div>
                            </div>
                            <div class="dashboard-metric">
                                <div class="dashboard-metric-label">取消</div>
                                <div class="dashboard-metric-value" id="cancelledBookings">0</div>
                            </div>
                        </div>
                        <button class="dashboard-card-button" onclick="switchSection('bookings')">前往訂單列表</button>
                    </div>
                </div>
            </section>

            <!-- 訂房記錄區 -->
            <section id="bookings-section" class="content-section">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">event_note</span> 訂房記錄管理</h2>
                    <div class="header-actions">
                        <button class="btn-secondary permission-required" data-permission="bookings.export" onclick="exportBookingsCSV()" title="匯出訂房資料 CSV">
                            <span class="material-symbols-outlined">download</span> 匯出 CSV
                        </button>
                        <button class="btn-refresh" onclick="reloadCurrentBookingView()">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                    </div>
                </div>

                <!-- 視圖切換標籤 -->
                <div class="view-tabs" style="margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
                    <button class="view-tab active" data-view="list" onclick="switchBookingView('list')">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">list</span> 列表
                    </button>
                    <button class="view-tab" data-view="calendar" onclick="switchBookingView('calendar')">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">calendar_month</span> 日曆
                    </button>
                </div>

                <!-- 列表視圖 -->
                <div id="bookingListView" class="booking-view">
                <!-- 搜尋和篩選 -->
                <div class="filter-bar" id="bookingListFilters">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="搜尋訂房編號、姓名、Email..." onkeyup="filterBookings()">
                        <span class="search-icon"><span class="material-symbols-outlined" style="font-size: 20px; vertical-align: middle;">search</span></span>
                    </div>
                    <div class="filter-group">
                        <select id="roomTypeFilter" onchange="filterBookings()">
                            <option value="">所有房型</option>
                            <option value="標準雙人房">標準雙人房</option>
                            <option value="豪華雙人房">豪華雙人房</option>
                            <option value="尊爵套房">尊爵套房</option>
                            <option value="家庭四人房">家庭四人房</option>
                        </select>
                        <select id="statusFilter" onchange="filterBookings()">
                            <option value="">所有付款狀態</option>
                            <option value="paid">已付款</option>
                            <option value="pending">待付款</option>
                            <option value="failed">付款失敗</option>
                            <option value="refunded">已退款</option>
                        </select>
                        <input
                            type="date"
                            id="checkInDateFilter"
                            onchange="filterBookings()"
                            style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"
                        >
                    </div>
                </div>

                <!-- 訂房記錄表格 -->
                <div class="table-container">
                    <table class="bookings-table">
                        <thead>
                            <tr>
                                <th>訂房編號</th>
                                <th>客戶姓名</th>
                                <th>房型</th>
                                <th>人數</th>
                                <th onclick="sortByCheckInDate()" style="cursor: pointer; user-select: none;">
                                    入住日期 
                                    <span id="checkInDateSortIcon" style="font-size: 12px; color: #667eea;">⇅</span>
                                </th>
                                <th>住宿天數</th>
                                <th>應付金額</th>
                                <th>付款方式</th>
                                <th>付款狀態</th>
                                <th>訂房狀態</th>
                                <th>郵件狀態</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="bookingsTableBody">
                            <tr>
                                <td colspan="12" class="loading">載入中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 分頁 -->
                <div class="pagination" id="pagination"></div>
                </div>

                <!-- 日曆視圖 -->
                <div id="bookingCalendarView" class="booking-view" style="display: none;">
                    <div class="calendar-controls" style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
                        <button class="btn-primary" onclick="changeCalendarMonth(-1)">
                            <span class="material-symbols-outlined">chevron_left</span> 上一個月
                        </button>
                        <h3 id="calendarMonthTitle" style="margin: 0; font-size: 20px; font-weight: 600;"></h3>
                        <button class="btn-primary" onclick="changeCalendarMonth(1)">
                            下一個月 <span class="material-symbols-outlined">chevron_right</span>
                        </button>
                    </div>
                    <div id="bookingCalendarContainer" class="calendar-container">
                        <div class="loading">載入日曆中...</div>
                    </div>
                    <!-- 日曆使用提示（右下角） -->
                    <div style="margin-top: 8px; font-size: 13px; color: #666; display: flex; justify-content: flex-end; align-items: center; gap: 6px;">
                        <span class="material-symbols-outlined" style="font-size: 18px; color: #2C8EC4;">info</span>
                        <span>提示：<strong>點選空白格可以快速新增訂房</strong>，點選已有訂單可以查看詳情。</span>
                    </div>
                </div>
            </section>

            <!-- 客戶管理區 -->
            <section id="customers-section" class="content-section">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">people</span> 客戶管理</h2>
                    <div class="header-actions">
                        <button class="btn-secondary permission-required" data-permission="customers.export" id="customerExportBtn" onclick="exportCustomersCSV()" style="display: none;" title="匯出客戶資料 CSV">
                            <span class="material-symbols-outlined">download</span> 匯出 CSV
                        </button>
                        <button class="btn-refresh" id="customerRefreshBtn" onclick="loadCustomers()" style="display: none;">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                        <button class="btn-refresh" id="memberLevelRefreshBtn" onclick="loadMemberLevels()" style="display: none;">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                    </div>
                </div>

                <!-- 分頁切換 -->
                <div class="tab-container" style="margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
                    <button class="tab-button active" onclick="switchCustomerTab('customers')" id="customersTab">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">people</span>
                        客戶列表
                    </button>
                    <button class="tab-button" onclick="switchCustomerTab('member-levels')" id="memberLevelsTab">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">workspace_premium</span>
                        客戶等級設定
                    </button>
                </div>

                <!-- 客戶列表內容 -->
                <div id="customersTabContent" class="tab-content">
                    <!-- 搜尋和篩選 -->
                    <div class="filter-bar">
                        <div class="search-box">
                            <input type="text" id="customerSearchInput" placeholder="搜尋客戶姓名、電話、Email..." onkeyup="filterCustomers()">
                            <span class="search-icon"><span class="material-symbols-outlined" style="font-size: 20px; vertical-align: middle;">search</span></span>
                        </div>
                    </div>

                    <!-- 客戶列表表格 -->
                    <div class="table-container">
                        <table class="bookings-table">
                            <thead>
                                <tr>
                                    <th style="text-align: left;">客戶姓名</th>
                                    <th style="text-align: left;">電話</th>
                                    <th style="text-align: left;">Email</th>
                                    <th style="text-align: center;">會員等級</th>
                                    <th style="text-align: center;">訂房次數</th>
                                    <th style="text-align: right;">總消費金額</th>
                                    <th style="text-align: left;">最後訂房日期</th>
                                    <th style="text-align: center;">操作</th>
                                </tr>
                            </thead>
                            <tbody id="customersTableBody">
                                <tr>
                                    <td colspan="8" class="loading">載入中...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 客戶等級設定內容 -->
                <div id="memberLevelsTabContent" class="tab-content" style="display: none;">
                    <div class="settings-container">
                        <div class="settings-card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3>會員等級設定</h3>
                                <button class="btn-primary permission-required" id="addMemberLevelBtn" data-permission="customers.edit" onclick="showAddMemberLevelModal()">
                                    <span class="material-symbols-outlined">add</span> 新增等級
                                </button>
                            </div>
                            <div class="table-container">
                                <table class="bookings-table">
                                    <thead>
                                        <tr>
                                            <th style="text-align: center;">排序</th>
                                            <th style="text-align: left;">等級名稱</th>
                                            <th style="text-align: right;">消費金額門檻</th>
                                            <th style="text-align: center;">訂房次數門檻</th>
                                            <th style="text-align: center;">折扣百分比</th>
                                            <th style="text-align: center;">狀態</th>
                                            <th style="text-align: center;">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="memberLevelsTableBody">
                                        <tr>
                                            <td colspan="7" class="loading">載入中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 統計資料區 -->
            <section id="statistics-section" class="content-section">
                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; gap: 16px;">
                    <h2 style="display: flex; align-items: center; gap: 8px; margin: 0;">
                        <span class="material-symbols-outlined" style="font-size: 28px;">monitoring</span>
                        <span>統計資料</span>
                    </h2>
                    <div class="header-actions" style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                        <div class="date-range-filter" style="display: flex; align-items: center; gap: 6px;">
                            <label for="statsStartDate" style="font-size: 13px; color: #666;">期間</label>
                            <input type="date" id="statsStartDate" style="padding: 4px 8px; font-size: 13px;">
                            <span>~</span>
                            <input type="date" id="statsEndDate" style="padding: 4px 8px; font-size: 13px;">
                        </div>
                        <button class="btn-secondary" onclick="applyStatisticsFilter()">套用</button>
                        <button class="btn-refresh" onclick="resetStatisticsFilter()">
                            <span class="material-symbols-outlined">refresh</span> 全部期間
                        </button>
                        <button class="btn-secondary permission-required" data-permission="statistics.export" onclick="exportStatisticsCSV()" title="匯出統計報表 CSV">
                            <span class="material-symbols-outlined">download</span> 匯出
                        </button>
                    </div>
                </div>

                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-icon"><span class="material-symbols-outlined">event_note</span></div>
                        <div class="stat-value" id="totalBookings">-</div>
                        <div class="stat-label">總訂房數</div>
                        <div class="stat-detail" id="totalBookingsDetail" style="margin-top: 8px; font-size: 14px; color: #666;">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><span class="material-symbols-outlined">money_bag</span></div>
                        <div class="stat-value" id="totalRevenue">-</div>
                        <div class="stat-label">總營收</div>
                        <div class="stat-detail" id="totalRevenueDetail" style="margin-top: 8px; font-size: 14px; color: #666;">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><span class="material-symbols-outlined">account_balance</span></div>
                        <div class="stat-value" id="transferBookings">-</div>
                        <div class="stat-label" id="transferBookingsLabel">匯款轉帳</div>
                        <div class="stat-detail" id="transferBookingsDetail" style="margin-top: 8px; font-size: 14px; color: #666;">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><span class="material-symbols-outlined">credit_card</span></div>
                        <div class="stat-value" id="cardBookings">-</div>
                        <div class="stat-label">線上刷卡</div>
                        <div class="stat-detail" id="cardBookingsDetail" style="margin-top: 8px; font-size: 14px; color: #666;">-</div>
                    </div>
                </div>

                <!-- 上月與本月統計 -->
                <div class="monthly-stats" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h3 style="margin-top: 0; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                        <span class="material-symbols-outlined" style="font-size: 24px;">calendar_month</span>
                        上月與本月統計
                    </h3>
                    <div class="monthly-stats-grid" id="monthlyStatsGrid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="loading">載入中...</div>
                    </div>
                </div>

                <!-- 房型統計 -->
                <div class="room-stats">
                    <h3>房型統計</h3>
                    <div class="room-stats-list" id="roomStatsList">
                        <div class="loading">載入中...</div>
                    </div>
                </div>
            </section>

            <!-- 房型管理區（包含假日管理分頁） -->
            <section id="room-types-section" class="content-section">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">king_bed</span> 房型管理</h2>
                    <div class="header-actions">
                        <button class="btn-primary permission-required" id="addRoomTypeBtn" data-permission="room_types.create" onclick="showAddRoomTypeModal()">
                            <span class="material-symbols-outlined">add</span> 新增房型
                        </button>
                        <button class="btn-refresh" id="roomTypeRefreshBtn" onclick="loadRoomTypes()" style="display: none;">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                        <button class="btn-refresh" id="holidayRefreshBtn" onclick="loadHolidays()" style="display: none;">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                    </div>
                </div>

                <!-- 分頁切換 -->
                <div class="tab-container" style="margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
                    <button class="tab-button active" onclick="switchRoomTypeTab('room-types')" id="roomTypesTab">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">king_bed</span>
                        房型管理
                    </button>
                    <button class="tab-button" onclick="switchRoomTypeTab('holidays')" id="holidaysTab">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">event</span>
                        假日管理
                    </button>
                </div>

                <!-- 房型管理內容 -->
                <div id="roomTypesTabContent" class="tab-content">
                    <div class="room-types-container">
                    <table class="bookings-table">
                        <thead>
                            <tr>
                                <th>排序</th>
                                <th>照片/圖示</th>
                                <th>房型代碼</th>
                                <th>房型名稱</th>
                                <th>入住人數</th>
                                <th>加床人數</th>
                                <th>平日價格/晚</th>
                                <th>假日加價/晚</th>
                                <th>銷售頁</th>
                                <th>狀態</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="roomTypesTableBody">
                            <tr>
                                <td colspan="11" class="loading">載入中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                </div>

                <!-- 假日管理內容 -->
                <div id="holidaysTabContent" class="tab-content" style="display: none;">
                    <!-- 平日/假日設定 -->
                    <div class="settings-card" style="margin-bottom: 20px;">
                        <h3>平日/假日設定</h3>
                        <div class="form-group">
                            <label>選擇假日（勾選的日期將視為假日，未勾選的日期為平日）</label>
                            <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-top: 10px;">
                                <label style="display: flex; flex-direction: column; align-items: center; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                    <input type="checkbox" id="weekdaySun" value="0" style="width: 20px; height: 20px; margin-bottom: 5px;" onchange="updateWeekdaySettings()">
                                    <span style="font-weight: 600;">週日</span>
                                </label>
                                <label style="display: flex; flex-direction: column; align-items: center; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                    <input type="checkbox" id="weekdayMon" value="1" style="width: 20px; height: 20px; margin-bottom: 5px;" onchange="updateWeekdaySettings()">
                                    <span style="font-weight: 600;">週一</span>
                                </label>
                                <label style="display: flex; flex-direction: column; align-items: center; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                    <input type="checkbox" id="weekdayTue" value="2" style="width: 20px; height: 20px; margin-bottom: 5px;" onchange="updateWeekdaySettings()">
                                    <span style="font-weight: 600;">週二</span>
                                </label>
                                <label style="display: flex; flex-direction: column; align-items: center; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                    <input type="checkbox" id="weekdayWed" value="3" style="width: 20px; height: 20px; margin-bottom: 5px;" onchange="updateWeekdaySettings()">
                                    <span style="font-weight: 600;">週三</span>
                                </label>
                                <label style="display: flex; flex-direction: column; align-items: center; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                    <input type="checkbox" id="weekdayThu" value="4" style="width: 20px; height: 20px; margin-bottom: 5px;" onchange="updateWeekdaySettings()">
                                    <span style="font-weight: 600;">週四</span>
                                </label>
                                <label style="display: flex; flex-direction: column; align-items: center; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                    <input type="checkbox" id="weekdayFri" value="5" style="width: 20px; height: 20px; margin-bottom: 5px;" onchange="updateWeekdaySettings()">
                                    <span style="font-weight: 600;">週五</span>
                                </label>
                                <label style="display: flex; flex-direction: column; align-items: center; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                    <input type="checkbox" id="weekdaySat" value="6" style="width: 20px; height: 20px; margin-bottom: 5px;" onchange="updateWeekdaySettings()">
                                    <span style="font-weight: 600;">週六</span>
                                </label>
                            </div>
                            <small style="display: block; margin-top: 10px; color: #666;">
                                💡 提示：勾選的日期將使用「假日價格（平日價格 + 假日加價）」，未勾選的日期將使用「平日價格」。<br>
                                例如：勾選週六、週日，則週一到週五為平日；或勾選週五到週日，則週一到週四為平日。
                            </small>
                        </div>
                        <button class="btn-save" onclick="saveWeekdaySettings()" style="margin-top: 15px;">儲存平日/假日設定</button>
                    </div>

                    <!-- 假日管理內容 -->
                    <div class="settings-container">
                        <div class="settings-card">
                            <h3>新增單一假日</h3>
                            <div class="form-group">
                                <label>日期</label>
                                <input type="date" id="holidayDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div class="form-group">
                                <label>假日名稱（選填）</label>
                                <input type="text" id="holidayName" placeholder="例如：元旦" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <button type="button" class="btn-save permission-required" data-permission="room_types.edit" onclick="addHoliday()">新增</button>
                        </div>
                        
                        <div class="settings-card" style="margin-top: 20px;">
                            <h3>新增連續假期</h3>
                            <div class="form-group">
                                <label>開始日期</label>
                                <input type="date" id="holidayStartDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div class="form-group">
                                <label>結束日期</label>
                                <input type="date" id="holidayEndDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div class="form-group">
                                <label>假日名稱（選填）</label>
                                <input type="text" id="holidayRangeName" placeholder="例如：春節連假" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <button type="button" class="btn-save permission-required" data-permission="room_types.edit" onclick="addHolidayRange()">新增</button>
                        </div>
                        
                        <div class="settings-card" style="margin-top: 20px;">
                            <h3>假日列表</h3>
                            <div id="holidaysList" style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; background: #f9f9f9;">
                                <div class="loading">載入中...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 加購商品管理區 -->
            <section id="addons-section" class="content-section">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">add_shopping_cart</span> 加購商品管理</h2>
                    <div class="header-actions">
                        <button class="btn-primary permission-required" id="addAddonBtn" data-permission="addons.create" onclick="showAddAddonModal()">
                            <span class="material-symbols-outlined">add</span> 新增加購商品
                        </button>
                        <button class="btn-refresh" onclick="loadAddons()">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                    </div>
                </div>

                <!-- 前台啟用開關 -->
                <div class="settings-card" style="margin-bottom: 20px;">
                    <h3>前台啟用設定</h3>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enableAddonsFrontend" style="width: 20px; height: 20px;" onchange="toggleAddonsFrontend(this.checked)">
                            <span>啟用前台加購商品功能</span>
                        </label>
                        <small>關閉後，前台將不顯示加購商品選項，也不計算加購商品價格</small>
                    </div>
                </div>

                <div class="room-types-container">
                    <table class="bookings-table">
                        <thead>
                            <tr>
                                <th>排序</th>
                                <th>圖示</th>
                                <th>商品代碼</th>
                                <th>商品名稱</th>
                                <th>價格</th>
                                <th>狀態</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="addonsTableBody">
                            <tr>
                                <td colspan="7" class="loading">載入中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 優惠代碼管理區 -->
            <section id="promo-codes-section" class="content-section">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">local_offer</span> 優惠代碼管理</h2>
                    <div class="header-actions">
                        <button class="btn-primary permission-required" id="addPromoCodeBtn" data-permission="promo_codes.create" onclick="showAddPromoCodeModal()">
                            <span class="material-symbols-outlined">add</span> 新增優惠代碼
                        </button>
                        <button class="btn-refresh" onclick="loadPromoCodes()">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                    </div>
                </div>

                <div class="room-types-container">
                    <table class="bookings-table">
                        <thead>
                            <tr>
                                <th style="text-align: left;">優惠代碼</th>
                                <th style="text-align: left;">優惠名稱</th>
                                <th style="text-align: center;">折扣類型</th>
                                <th style="text-align: right;">折扣值</th>
                                <th style="text-align: right;">最低消費</th>
                                <th style="text-align: center;">使用次數</th>
                                <th style="text-align: left;">有效期</th>
                                <th style="text-align: center;">狀態</th>
                                <th style="text-align: center;">操作</th>
                            </tr>
                        </thead>
                        <tbody id="promoCodesTableBody">
                            <tr>
                                <td colspan="9" class="loading">載入中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 早鳥優惠管理區 -->
            <section id="early-bird-section" class="content-section">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">nest_eco_leaf</span> 早鳥/晚鳥優惠管理</h2>
                    <div class="header-actions">
                        <button class="btn-primary permission-required" data-permission="promo_codes.create" onclick="showAddEarlyBirdModal()">
                            <span class="material-symbols-outlined">add</span> 新增優惠規則
                        </button>
                        <button class="btn-refresh" onclick="loadEarlyBirdSettings()">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                    </div>
                </div>
                
                <!-- 說明區塊 -->
                <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: flex-start; gap: 10px;">
                        <span class="material-symbols-outlined" style="color: #0284c7; font-size: 22px; margin-top: 2px;">info</span>
                        <div style="font-size: 14px; color: #475569; line-height: 1.6;">
                            <strong style="color: #0284c7;">早鳥/晚鳥優惠說明：</strong><br>
                            系統會根據「訂房日」距「入住日」的天數，自動套用符合條件的優惠折扣。<br>
                            例如：提前 30 天以上訂房享 8 折、提前 14 天以上享 9 折。<br>
                            當多條規則同時符合時，系統會套用<strong>優先級最高</strong>的規則。<br>
                            若同時使用優惠代碼，系統會根據「是否可疊加」的設定自動處理。
                        </div>
                    </div>
                </div>

                <div class="room-types-container">
                    <table class="bookings-table">
                        <thead>
                            <tr>
                                <th style="text-align: left;">規則名稱</th>
                                <th style="text-align: center;">折扣類型</th>
                                <th style="text-align: right;">折扣值</th>
                                <th style="text-align: center;">提前天數</th>
                                <th style="text-align: left;">適用房型</th>
                                <th style="text-align: left;">有效期間</th>
                                <th style="text-align: center;">優先級</th>
                                <th style="text-align: center;">狀態</th>
                                <th style="text-align: center;">操作</th>
                            </tr>
                        </thead>
                        <tbody id="earlyBirdTableBody">
                            <tr>
                                <td colspan="9" class="loading">載入中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- 早鳥優惠 Modal -->
            <div id="earlyBirdModal" class="modal" style="display: none;">
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3 id="earlyBirdModalTitle">新增早鳥優惠規則</h3>
                        <button class="modal-close" onclick="closeEarlyBirdModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="earlyBirdForm" onsubmit="saveEarlyBirdSetting(event)">
                            <input type="hidden" id="earlyBirdId">
                            
                            <div class="form-group">
                                <label for="earlyBirdName">規則名稱 <span style="color: #e74c3c;">*</span></label>
                                <input type="text" id="earlyBirdName" required placeholder="例如：提前30天早鳥優惠">
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div class="form-group">
                                    <label for="earlyBirdDiscountType">折扣類型 <span style="color: #e74c3c;">*</span></label>
                                    <select id="earlyBirdDiscountType" required onchange="toggleEarlyBirdMaxDiscount()">
                                        <option value="percent">百分比折扣 (%)</option>
                                        <option value="fixed">固定金額 (NT$)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="earlyBirdDiscountValue">折扣值 <span style="color: #e74c3c;">*</span></label>
                                    <input type="number" id="earlyBirdDiscountValue" required min="0" step="0.01" placeholder="例如：20（表示打8折）">
                                </div>
                            </div>
                            
                            <div class="form-group" id="earlyBirdMaxDiscountGroup">
                                <label for="earlyBirdMaxDiscount">最高折扣金額（百分比折扣專用，選填）</label>
                                <input type="number" id="earlyBirdMaxDiscount" min="0" placeholder="例如：500（表示最多折NT$500）">
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div class="form-group">
                                    <label for="earlyBirdMinDays">最少提前天數 <span style="color: #e74c3c;">*</span></label>
                                    <input type="number" id="earlyBirdMinDays" required min="0" value="0" placeholder="例如：14">
                                    <small style="color: #888;">入住日前至少需提前幾天訂房</small>
                                </div>
                                <div class="form-group">
                                    <label for="earlyBirdMaxDays">最多提前天數（選填）</label>
                                    <input type="number" id="earlyBirdMaxDays" min="0" placeholder="例如：60（留空表示不限）">
                                    <small style="color: #888;">留空表示不設上限</small>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="earlyBirdRoomTypes">適用房型</label>
                                <div id="earlyBirdRoomTypesCheckboxes" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 8px;">
                                    <!-- 動態載入房型 -->
                                    <span style="color: #888;">載入中...</span>
                                </div>
                                <small style="color: #888;">不勾選表示適用所有房型</small>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div class="form-group">
                                    <label for="earlyBirdStartDate">生效日期（選填）</label>
                                    <input type="date" id="earlyBirdStartDate">
                                    <small style="color: #888;">留空表示立即生效</small>
                                </div>
                                <div class="form-group">
                                    <label for="earlyBirdEndDate">結束日期（選填）</label>
                                    <input type="date" id="earlyBirdEndDate">
                                    <small style="color: #888;">留空表示永不過期</small>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div class="form-group">
                                    <label for="earlyBirdPriority">優先級</label>
                                    <input type="number" id="earlyBirdPriority" min="0" value="0" placeholder="數字越大優先級越高">
                                    <small style="color: #888;">多條規則同時符合時，優先使用數字最大的</small>
                                </div>
                                <div class="form-group">
                                    <label for="earlyBirdIsActive">狀態</label>
                                    <select id="earlyBirdIsActive">
                                        <option value="1">啟用</option>
                                        <option value="0">停用</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="earlyBirdDescription">說明（選填）</label>
                                <textarea id="earlyBirdDescription" rows="2" placeholder="此優惠規則的補充說明..."></textarea>
                            </div>
                            
                            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; padding-top: 16px; border-top: 1px solid #e0e0e0;">
                                <button type="button" onclick="closeEarlyBirdModal()" style="padding: 10px 24px; border: none; background: #dc3545; color: #fff; border-radius: 8px; cursor: pointer; font-size: 14px;">取消</button>
                                <button type="submit" class="btn-primary" style="padding: 10px 24px;">儲存</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- 系統設定區 -->
            <section id="settings-section" class="content-section">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">settings</span> 系統設定</h2>
                    <button class="btn-refresh" onclick="loadSettings()">
                        <span class="material-symbols-outlined">refresh</span> 重新整理
                    </button>
                </div>

                <!-- 分頁導航 -->
                <div class="tab-container" style="margin-bottom: 20px;">
                    <button class="tab-button active" onclick="switchSettingsTab('basic')" id="settingsTabBasic">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle;">info</span>
                        基本設定
                    </button>
                    <button class="tab-button" onclick="switchSettingsTab('payment')" id="settingsTabPayment">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle;">payment</span>
                        付款設定
                    </button>
                    <button class="tab-button" onclick="switchSettingsTab('email')" id="settingsTabEmail">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle;">mail</span>
                        郵件設定
                    </button>
                    <button class="tab-button" onclick="switchSettingsTab('line')" id="settingsTabLine">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle;">chat</span>
                        LINE 設定
                    </button>
                    <button class="tab-button" onclick="switchSettingsTab('security')" id="settingsTabSecurity">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle;">lock</span>
                        帳號安全
                    </button>
                </div>

                <div class="settings-container">
                    <!-- 基本設定分頁 -->
                    <div id="settingsTabBasicContent" class="tab-content active">
                        <!-- 旅館資訊區塊 -->
                        <div style="margin-top: 0;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #3498db;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #3498db; margin-right: 10px;">hotel</span>
                                <h3 style="margin: 0; color: #2c3e50;">旅館資訊</h3>
                            </div>
                            
                            <div class="settings-card" style="margin-top: 0;">
                                <div class="form-group">
                                    <label>旅館名稱</label>
                                    <input type="text" id="hotelName" placeholder="例如：XX旅館">
                                    <small>旅館或民宿的名稱</small>
                                </div>
                                <div class="form-group">
                                    <label>旅館電話</label>
                                    <input type="text" id="hotelPhone" placeholder="例如：02-1234-5678">
                                    <small>聯絡電話</small>
                                </div>
                                <div class="form-group">
                                    <label>旅館地址</label>
                                    <input type="text" id="hotelAddress" placeholder="例如：台北市信義區信義路五段7號">
                                    <small>完整地址</small>
                                </div>
                                <div class="form-group">
                                    <label>旅館信箱</label>
                                    <input type="email" id="hotelEmail" placeholder="例如：service@hotel.com">
                                    <small>聯絡信箱</small>
                                </div>
                                <div class="form-group">
                                    <label>管理員通知信箱 <span style="color: red;">*</span></label>
                                    <input type="email" id="adminEmail" placeholder="例如：admin@hotel.com">
                                    <small>新訂房通知郵件會寄到此信箱</small>
                                </div>
                                <button class="btn-save" onclick="saveHotelInfoSettings()">儲存設定</button>
                            </div>
                        </div>
                    </div>

                    <!-- 付款設定分頁 -->
                    <div id="settingsTabPaymentContent" class="tab-content">
                        <!-- 付款方式設定 -->
                        <div style="margin-top: 0;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #3498db;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #3498db; margin-right: 10px;">payment</span>
                                <h3 style="margin: 0; color: #2c3e50;">付款方式設定</h3>
                            </div>
                            
                            <div class="settings-card" style="margin-top: 0;">
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="enableTransfer" style="width: 20px; height: 20px;">
                                        <span>啟用匯款轉帳</span>
                                    </label>
                                    <small>勾選後，客戶在前台可以選擇匯款轉帳付款</small>
                                </div>
                                <div class="form-group">
                                    <label style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="enableCard" style="width: 20px; height: 20px;">
                                        <span>啟用線上刷卡</span>
                                    </label>
                                    <small>勾選後，客戶在前台可以選擇線上刷卡付款（需填寫綠界串接碼）</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 付款設定 -->
                        <div class="settings-card" style="margin-top: 20px;">
                            <h3>付款設定</h3>
                            <div class="form-group">
                                <label>訂金百分比</label>
                                <div class="input-group">
                                    <input type="number" id="depositPercentage" min="0" max="100" step="1" placeholder="30">
                                    <span class="input-suffix">%</span>
                                </div>
                                <small>設定訂金佔總金額的百分比（例如：30 表示 30%）</small>
                            </div>
                            <button class="btn-save" onclick="savePaymentSettings()">儲存設定</button>
                        </div>
                        
                        <!-- 分隔線 -->
                        <div style="margin-top: 30px; margin-bottom: 30px; border-top: 1px solid #e0e0e0;"></div>
                        
                        <!-- 匯款帳號設定區塊 -->
                        <div style="margin-top: 0;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #3498db;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #3498db; margin-right: 10px;">account_balance</span>
                                <h3 style="margin: 0; color: #2c3e50;">匯款帳號設定</h3>
                            </div>
                            
                            <div class="settings-card" style="margin-top: 0;">
                                <div class="form-group">
                                    <label>銀行名稱</label>
                                    <input type="text" id="bankName" placeholder="例如：XXX銀行">
                                    <small>銀行全名</small>
                                </div>
                                <div class="form-group">
                                    <label>分行名稱</label>
                                    <input type="text" id="bankBranch" placeholder="例如：XXX分行">
                                    <small>分行全名</small>
                                </div>
                                <div class="form-group">
                                    <label>帳號</label>
                                    <input type="text" id="bankAccount" placeholder="例如：1234567890123">
                                    <small>匯款帳號</small>
                                </div>
                                <div class="form-group">
                                    <label>戶名</label>
                                    <input type="text" id="accountName" placeholder="例如：XXX">
                                    <small>帳戶戶名</small>
                                </div>
                                <button class="btn-save" onclick="saveRemittanceAccountSettings()">儲存設定</button>
                            </div>
                        </div>
                        
                        <!-- 綠界支付設定區塊 -->
                        <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #e0e0e0;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #3498db;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #3498db; margin-right: 10px;">credit_card</span>
                                <h3 style="margin: 0; color: #2c3e50;">綠界支付設定</h3>
                            </div>
                            
                            <div class="settings-card" style="margin-top: 0;">
                                <div class="form-group">
                                    <label>MerchantID（商店代號）</label>
                                    <input type="text" id="ecpayMerchantID" placeholder="例如：2000132">
                                    <small>綠界提供的商店代號</small>
                                </div>
                                <div class="form-group">
                                    <label>HashKey（金鑰）</label>
                                    <input type="text" id="ecpayHashKey" placeholder="例如：5294y06JbISpM5x9">
                                    <small>綠界提供的 HashKey</small>
                                </div>
                                <div class="form-group">
                                    <label>HashIV（向量）</label>
                                    <input type="text" id="ecpayHashIV" placeholder="例如：v77hoKGq4kWxNNIS">
                                    <small>綠界提供的 HashIV</small>
                                </div>
                                <button class="btn-save" onclick="saveEcpaySettings()">儲存設定</button>
                            </div>
                        </div>
                    </div>

                    <!-- 郵件設定分頁 -->
                    <div id="settingsTabEmailContent" class="tab-content">
                        <!-- Resend 發信設定區塊 -->
                        <div style="margin-top: 0;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #10b981;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #10b981; margin-right: 10px;">mail</span>
                                <h3 style="margin: 0; color: #2c3e50;">Resend 發信設定（推薦）</h3>
                            </div>
                            
                            <div class="settings-card" style="margin-top: 0;">
                                <div style="background-color: #d1fae5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                                    <p style="margin: 0; color: #059669; font-size: 14px;">
                                        <strong>📌 設定說明：</strong><br>
                                        Resend 是現代化的郵件服務，每月免費 3,000 封，設定簡單且穩定。請到 <a href="https://resend.com/api-keys" target="_blank" style="color: #059669; text-decoration: underline;">Resend 官網</a> 註冊並取得 API Key。
                                    </p>
                                </div>
                                
                                <div class="form-group">
                                    <label>Resend API Key <span style="color: red;">*</span></label>
                                    <input type="password" id="resendApiKey" placeholder="例如：re_xxxxxxxxxxxx">
                                    <small>從 Resend 官網取得的 API Key（優先使用，如果設定則會自動使用 Resend）</small>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn-save" onclick="saveResendSettings()">儲存設定</button>
                                    <button class="btn-save" onclick="checkResendStatus()" style="background-color: #3b82f6;">檢查設定狀態</button>
                                </div>
                                <div id="resendStatusCheck" style="margin-top: 20px; display: none;"></div>
                            </div>
                        </div>
                        
                        <!-- Gmail 發信設定區塊 -->
                        <div style="margin-top: 30px;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #3498db;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #3498db; margin-right: 10px;">mail</span>
                                <h3 style="margin: 0; color: #2c3e50;">Gmail 發信設定（備用）</h3>
                            </div>
                            
                            <div class="settings-card" style="margin-top: 0;">
                                <div style="background-color: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                                    <p style="margin: 0; color: #1976d2; font-size: 14px;">
                                        <strong>📌 設定說明：</strong><br>
                                        使用 Gmail OAuth2 認證發送郵件，請先到 <a href="https://console.cloud.google.com/" target="_blank" style="color: #1976d2; text-decoration: underline;">Google Cloud Console</a> 建立 OAuth2 憑證，然後到 <a href="https://developers.google.com/oauthplayground" target="_blank" style="color: #1976d2; text-decoration: underline;">OAuth2 Playground</a> 取得 Refresh Token。
                                    </p>
                                </div>
                                
                                <div class="form-group">
                                    <label>Gmail 帳號 <span style="color: red;">*</span></label>
                                    <input type="email" id="emailUser" placeholder="例如：your-email@gmail.com">
                                    <small>用於發送郵件的 Gmail 帳號</small>
                                </div>
                                <div class="form-group">
                                    <label>Client ID <span style="color: red;">*</span></label>
                                    <input type="text" id="gmailClientID" placeholder="例如：123456789-xxx.apps.googleusercontent.com">
                                    <small>從 Google Cloud Console 取得的 OAuth2 Client ID</small>
                                </div>
                                <div class="form-group">
                                    <label>Client Secret <span style="color: red;">*</span></label>
                                    <input type="password" id="gmailClientSecret" placeholder="例如：GOCSPX-xxxxxxxxxxxx">
                                    <small>從 Google Cloud Console 取得的 OAuth2 Client Secret</small>
                                </div>
                                <div class="form-group">
                                    <label>Refresh Token <span style="color: red;">*</span></label>
                                    <input type="password" id="gmailRefreshToken" placeholder="例如：1//xxxxxxxxxxxx">
                                    <small>從 OAuth2 Playground 取得的 Refresh Token</small>
                                </div>
                                <button class="btn-save" onclick="saveGmailSettings()">儲存設定</button>
                            </div>
                        </div>
                    </div>

                    <!-- LINE 設定分頁 -->
                    <div id="settingsTabLineContent" class="tab-content">
                        <!-- LINE 官方帳號設定區塊 -->
                        <div style="margin-top: 0;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #06C755;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #06C755; margin-right: 10px;">chat</span>
                                <h3 style="margin: 0; color: #2c3e50;">LINE 官方帳號設定</h3>
                            </div>
                            
                            <div class="settings-card" style="margin-top: 0;">
                                <div style="background-color: #d1fae5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                                    <p style="margin: 0; color: #059669; font-size: 14px;">
                                        <strong>📌 設定說明：</strong><br>
                                        設定 LINE 官方帳號後，用戶可以從 LINE 開啟訂房頁面，訂房成功後會自動發送 LINE 訊息通知。請到 <a href="https://developers.line.biz/console/" target="_blank" style="color: #059669; text-decoration: underline;">LINE Developers Console</a> 建立 Messaging API Channel 並取得相關設定值。
                                    </p>
                                </div>
                                
                                <div class="form-group">
                                    <label>Channel Access Token</label>
                                    <input type="password" id="lineChannelAccessToken" placeholder="例如：xxxxxxxxxxxxxxxxxxxx">
                                    <small>從 LINE Developers Console 取得的 Channel Access Token</small>
                                </div>
                                <div class="form-group">
                                    <label>Channel Secret</label>
                                    <input type="password" id="lineChannelSecret" placeholder="例如：xxxxxxxxxxxxxxxxxxxx">
                                    <small>從 LINE Developers Console 取得的 Channel Secret</small>
                                </div>
                                <div class="form-group">
                                    <label>LIFF ID</label>
                                    <input type="text" id="lineLiffId" placeholder="例如：1234567890-abcdefgh">
                                    <small>從 LINE Developers Console 建立的 LIFF App ID</small>
                                </div>
                                <div class="form-group">
                                    <label>LIFF URL（選填）</label>
                                    <input type="text" id="lineLiffUrl" placeholder="例如：https://liff.line.me/1234567890-abcdefgh">
                                    <small>LIFF App 的完整 URL（系統會自動產生，此欄位為選填）</small>
                                </div>
                                <button class="btn-save" onclick="saveLineSettings()">儲存設定</button>
                            </div>
                        </div>
                    </div>

                    <!-- 帳號安全分頁 -->
                    <div id="settingsTabSecurityContent" class="tab-content">
                        <!-- 帳號安全設定區塊 -->
                        <div style="margin-top: 0;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #3498db;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #3498db; margin-right: 10px;">lock</span>
                                <h3 style="margin: 0; color: #2c3e50;">帳號安全設定</h3>
                            </div>
                            
                            <div class="settings-card" style="margin-top: 0;">
                                <h3>修改管理員密碼</h3>
                                <div class="form-group">
                                    <label>目前密碼</label>
                                    <input type="password" id="currentPassword" placeholder="請輸入目前密碼" autocomplete="current-password">
                                    <small>請輸入您目前的密碼以驗證身份</small>
                                </div>
                                <div class="form-group">
                                    <label>新密碼</label>
                                    <input type="password" id="newPassword" placeholder="請輸入新密碼" autocomplete="new-password">
                                    <small>建議使用至少 8 個字元，包含大小寫字母、數字和符號</small>
                                </div>
                                <div class="form-group">
                                    <label>確認新密碼</label>
                                    <input type="password" id="confirmPassword" placeholder="請再次輸入新密碼" autocomplete="new-password">
                                    <small>請再次輸入新密碼以確認</small>
                                </div>
                                <button class="btn-save" onclick="changePassword()">修改密碼</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 郵件模板區 -->
            <section id="email-templates-section" class="content-section">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">mail</span> 郵件模板管理</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-refresh" onclick="loadEmailTemplates()">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                    </div>
                </div>

                <div class="email-templates-container">
                    <div class="templates-list" id="emailTemplatesList">
                        <div class="loading">載入中...</div>
                    </div>
                </div>
            </section>

            <!-- 管理員管理區（包含角色權限分頁） -->
            <section id="admin-management-section" class="content-section">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">manage_accounts</span> 權限管理</h2>
                    <div class="header-actions">
                        <button class="btn-primary permission-required" onclick="showAddAdminModal()" id="addAdminBtn" data-permission="admins.create">
                            <span class="material-symbols-outlined">person_add</span> 新增管理員
                        </button>
                        <button class="btn-refresh" id="adminRefreshBtn" onclick="loadAdmins()">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                        <button class="btn-primary permission-required" onclick="showAddRoleModal()" id="addRoleBtn" data-permission="roles.create" style="display: none;">
                            <span class="material-symbols-outlined">add</span> 新增角色
                        </button>
                        <button class="btn-refresh" id="roleRefreshBtn" onclick="loadRoles()" style="display: none;">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                    </div>
                </div>

                <!-- 分頁切換 -->
                <div class="tab-container" style="margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
                    <button class="tab-button active" onclick="switchAdminTab('admins')" id="adminsTab">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">manage_accounts</span>
                        管理員列表
                    </button>
                    <button class="tab-button permission-required" data-permission="roles.view" onclick="switchAdminTab('roles')" id="rolesTab">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">admin_panel_settings</span>
                        角色權限
                    </button>
                </div>

                <!-- 管理員列表內容 -->
                <div id="adminsTabContent" class="tab-content">
                    <div class="table-container">
                        <table class="bookings-table">
                            <thead>
                                <tr>
                                    <th style="text-align: center;">ID</th>
                                    <th style="text-align: left;">帳號</th>
                                    <th style="text-align: left;">Email</th>
                                    <th style="text-align: center;">角色</th>
                                    <th style="text-align: left;">部門</th>
                                    <th style="text-align: center;">狀態</th>
                                    <th style="text-align: left;">最後登入</th>
                                    <th style="text-align: center;">操作</th>
                                </tr>
                            </thead>
                            <tbody id="adminsTableBody">
                                <tr>
                                    <td colspan="8" class="loading">載入中...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 角色權限內容 -->
                <div id="rolesTabContent" class="tab-content" style="display: none;">
                    <!-- 角色列表 -->
                    <div class="roles-container">
                        <div class="table-container">
                            <table class="bookings-table">
                                <thead>
                                    <tr>
                                        <th style="text-align: center;">ID</th>
                                        <th style="text-align: left;">角色代碼</th>
                                        <th style="text-align: left;">顯示名稱</th>
                                        <th style="text-align: left;">描述</th>
                                        <th style="text-align: center;">權限數</th>
                                        <th style="text-align: center;">管理員數</th>
                                        <th style="text-align: center;">系統角色</th>
                                        <th style="text-align: center;">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="rolesTableBody">
                                    <tr>
                                        <td colspan="8" class="loading">載入中...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 權限對照表 -->
                    <div class="settings-card" style="margin-top: 30px;">
                        <h3 style="display: flex; align-items: center; gap: 10px;">
                            <span class="material-symbols-outlined">checklist</span>
                            權限代碼說明
                        </h3>
                        <div id="permissionsReferenceList" style="margin-top: 15px;">
                            <div class="loading">載入中...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 操作日誌區 -->
            <section id="logs-section" class="content-section">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">history</span> 操作日誌</h2>
                    <div class="header-actions">
                        <button class="btn-refresh" onclick="loadLogs()">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                    </div>
                </div>

                <!-- 篩選工具列 -->
                <div class="settings-card" style="margin-bottom: 20px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 12px; align-items: flex-end;">
                        <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 150px;">
                            <label>管理員</label>
                            <select id="logFilterAdmin" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">全部</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 150px;">
                            <label>操作類型</label>
                            <select id="logFilterAction" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">全部</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 150px;">
                            <label>資源類型</label>
                            <select id="logFilterResourceType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">全部</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 140px;">
                            <label>開始日期</label>
                            <input type="date" id="logFilterStartDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 140px;">
                            <label>結束日期</label>
                            <input type="date" id="logFilterEndDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button class="btn-primary" onclick="loadLogs(1)" style="height: 38px;">
                            <span class="material-symbols-outlined">search</span> 查詢
                        </button>
                        <button class="btn-refresh" onclick="resetLogFilters()" style="height: 38px;">
                            <span class="material-symbols-outlined">restart_alt</span> 重置
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="bookings-table">
                        <thead>
                            <tr>
                                <th style="text-align: center; width: 60px;">ID</th>
                                <th style="text-align: left;">時間</th>
                                <th style="text-align: left;">管理員</th>
                                <th style="text-align: left;">操作</th>
                                <th style="text-align: left;">資源</th>
                                <th style="text-align: left;">詳細資訊</th>
                                <th style="text-align: left;">IP 位址</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody">
                            <tr>
                                <td colspan="7" class="loading">載入中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="logsPagination" class="pagination" style="margin-top: 15px;"></div>
            </section>

            <!-- 銷售頁管理區 -->
            <section id="landing-page-section" class="content-section">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">web</span> 銷售頁管理</h2>
                    <div class="header-actions">
                        <a href="landing.html" target="_blank" class="btn-secondary" style="text-decoration: none;">
                            <span class="material-symbols-outlined">open_in_new</span> 預覽銷售頁
                        </a>
                        <button class="btn-refresh" onclick="loadLandingSettings()">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                    </div>
                </div>

                <!-- 分頁導航 -->
                <div class="tab-container" style="margin-bottom: 20px;">
                    <button class="tab-button active" onclick="switchLandingTab('basic')" id="landingTabBasic">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle;">edit</span>
                        基本資訊
                    </button>
                    <button class="tab-button" onclick="switchLandingTab('features')" id="landingTabFeatures">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle;">star</span>
                        特色賣點
                    </button>
                    <button class="tab-button" onclick="switchLandingTab('rooms')" id="landingTabRooms">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle;">king_bed</span>
                        房型展示
                    </button>
                    <button class="tab-button" onclick="switchLandingTab('reviews')" id="landingTabReviews">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle;">reviews</span>
                        客戶評價
                    </button>
                    <button class="tab-button" onclick="switchLandingTab('contact')" id="landingTabContact">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle;">location_on</span>
                        聯絡與社群
                    </button>
                    <button class="tab-button" onclick="switchLandingTab('tracking')" id="landingTabTracking">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle;">monitoring</span>
                        廣告追蹤
                    </button>
                    <button class="tab-button" onclick="switchLandingTab('theme')" id="landingTabTheme">
                        <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle;">palette</span>
                        色系設定
                    </button>
                </div>

                <div class="settings-container">
                    <!-- 基本資訊分頁 -->
                    <div id="landingTabBasicContent" class="tab-content active">
                        <div style="margin-top: 0;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #9b59b6;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #9b59b6; margin-right: 10px;">home</span>
                                <h3 style="margin: 0; color: #2c3e50;">Hero 區塊設定</h3>
                            </div>
                            <div class="settings-card" style="margin-top: 0;">
                                <div class="form-group">
                                    <label>民宿名稱</label>
                                    <input type="text" id="landingName" placeholder="例如：悠然山居民宿">
                                    <small>顯示在導航列和頁尾的品牌名稱</small>
                                </div>
                                <div class="form-group">
                                    <label>主標題</label>
                                    <input type="text" id="landingTitle" placeholder="例如：遠離塵囂 擁抱自然">
                                    <small>Hero 區塊的大標題（支援用 &lt;br&gt; 換行）</small>
                                </div>
                                <div class="form-group">
                                    <label>副標題</label>
                                    <textarea id="landingSubtitle" rows="2" placeholder="例如：坐落於青山綠水間的悠然山居，讓您在繁忙生活中找到片刻寧靜"></textarea>
                                    <small>Hero 區塊的說明文字</small>
                                </div>
                                <div class="form-group">
                                    <label>醒目標籤</label>
                                    <input type="text" id="landingBadge" placeholder="例如：限時優惠">
                                    <small>Hero 區塊上方的小標籤</small>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                                    <div class="form-group">
                                        <label>價格前綴</label>
                                        <input type="text" id="landingPricePrefix" placeholder="例如：每晚只要">
                                    </div>
                                    <div class="form-group">
                                        <label>促銷價格</label>
                                        <input type="text" id="landingPriceAmount" placeholder="例如：NT$ 2,800">
                                    </div>
                                    <div class="form-group">
                                        <label>原價</label>
                                        <input type="text" id="landingPriceOriginal" placeholder="例如：原價 NT$ 3,500">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Hero 背景圖片</label>
                                    <input type="hidden" id="landingHeroImage" value="">
                                    <div id="heroImageUploadArea" style="border: 2px dashed #ccc; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s; background: #fafafa; position: relative;" onclick="document.getElementById('heroImageInput').click()">
                                        <div id="heroImagePreview">
                                            <span class="material-symbols-outlined" style="font-size: 48px; color: #aaa; display: block; margin-bottom: 8px;">add_photo_alternate</span>
                                            <p style="color: #888; margin: 0;">點擊上傳 Hero 背景圖片</p>
                                            <small style="color: #aaa;">支援 JPG、PNG、WebP，建議尺寸 1920x1080 以上，最大 5MB</small>
                                        </div>
                                    </div>
                                    <input type="file" id="heroImageInput" accept="image/jpeg,image/png,image/webp" style="display: none;" onchange="handleHeroImageUpload(this)">
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 30px;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e67e22;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #e67e22; margin-right: 10px;">timer</span>
                                <h3 style="margin: 0; color: #2c3e50;">限時優惠設定</h3>
                            </div>
                            <div class="settings-card" style="margin-top: 0;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div class="form-group">
                                        <label>優惠倒數天數</label>
                                        <div class="input-group">
                                            <input type="number" id="landingCountdownDays" min="1" max="30" value="7" placeholder="7">
                                            <span class="input-suffix">天</span>
                                        </div>
                                        <small>倒數計時器的天數</small>
                                    </div>
                                    <div class="form-group">
                                        <label>優惠說明文字</label>
                                        <input type="text" id="landingCountdownText" placeholder="例如：限時早鳥優惠！享 8 折 優惠">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>CTA 按鈕文字</label>
                                    <input type="text" id="landingCtaText" placeholder="例如：立即預訂">
                                    <small>所有「立即訂房」按鈕的文字</small>
                                </div>
                            </div>
                        </div>

                        <button class="btn-save" onclick="saveLandingSettings('basic')" style="margin-top: 20px;">
                            <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">save</span>
                            儲存基本資訊
                        </button>
                    </div>

                    <!-- 特色賣點分頁 -->
                    <div id="landingTabFeaturesContent" class="tab-content">
                        <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #2ecc71;">
                            <span class="material-symbols-outlined" style="font-size: 24px; color: #2ecc71; margin-right: 10px;">auto_awesome</span>
                            <h3 style="margin: 0; color: #2c3e50;">四大特色賣點</h3>
                        </div>
                        <div id="landingFeaturesContainer">
                            <div class="settings-card" style="margin-bottom: 15px;" data-feature="1">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">特色 1</h4>
                                <div style="display: grid; grid-template-columns: 120px 1fr; gap: 15px;">
                                    <div class="form-group">
                                        <label>圖示</label>
                                        <input type="text" id="landingFeature1Icon" placeholder="landscape" value="landscape">
                                        <small><a href="https://fonts.google.com/icons" target="_blank">圖示查詢</a></small>
                                    </div>
                                    <div class="form-group">
                                        <label>標題</label>
                                        <input type="text" id="landingFeature1Title" placeholder="例如：絕美山景">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>說明</label>
                                    <textarea id="landingFeature1Desc" rows="2" placeholder="例如：每間房間都能欣賞到壯闊的山巒美景"></textarea>
                                </div>
                            </div>
                            <div class="settings-card" style="margin-bottom: 15px;" data-feature="2">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">特色 2</h4>
                                <div style="display: grid; grid-template-columns: 120px 1fr; gap: 15px;">
                                    <div class="form-group">
                                        <label>圖示</label>
                                        <input type="text" id="landingFeature2Icon" placeholder="spa" value="spa">
                                        <small><a href="https://fonts.google.com/icons" target="_blank">圖示查詢</a></small>
                                    </div>
                                    <div class="form-group">
                                        <label>標題</label>
                                        <input type="text" id="landingFeature2Title" placeholder="例如：私人湯屋">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>說明</label>
                                    <textarea id="landingFeature2Desc" rows="2" placeholder="例如：獨立溫泉湯屋，24 小時供應天然溫泉"></textarea>
                                </div>
                            </div>
                            <div class="settings-card" style="margin-bottom: 15px;" data-feature="3">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">特色 3</h4>
                                <div style="display: grid; grid-template-columns: 120px 1fr; gap: 15px;">
                                    <div class="form-group">
                                        <label>圖示</label>
                                        <input type="text" id="landingFeature3Icon" placeholder="restaurant" value="restaurant">
                                        <small><a href="https://fonts.google.com/icons" target="_blank">圖示查詢</a></small>
                                    </div>
                                    <div class="form-group">
                                        <label>標題</label>
                                        <input type="text" id="landingFeature3Title" placeholder="例如：精緻早餐">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>說明</label>
                                    <textarea id="landingFeature3Desc" rows="2" placeholder="例如：使用在地新鮮食材，每日現做的豐盛早餐"></textarea>
                                </div>
                            </div>
                            <div class="settings-card" style="margin-bottom: 15px;" data-feature="4">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">特色 4</h4>
                                <div style="display: grid; grid-template-columns: 120px 1fr; gap: 15px;">
                                    <div class="form-group">
                                        <label>圖示</label>
                                        <input type="text" id="landingFeature4Icon" placeholder="pets" value="pets">
                                        <small><a href="https://fonts.google.com/icons" target="_blank">圖示查詢</a></small>
                                    </div>
                                    <div class="form-group">
                                        <label>標題</label>
                                        <input type="text" id="landingFeature4Title" placeholder="例如：寵物友善">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>說明</label>
                                    <textarea id="landingFeature4Desc" rows="2" placeholder="例如：帶著毛小孩一起來度假"></textarea>
                                </div>
                            </div>
                        </div>
                        <button class="btn-save" onclick="saveLandingSettings('features')" style="margin-top: 10px;">
                            <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">save</span>
                            儲存特色賣點
                        </button>
                    </div>

                    <!-- 房型展示分頁 -->
                    <div id="landingTabRoomsContent" class="tab-content">
                        <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #3498db;">
                            <span class="material-symbols-outlined" style="font-size: 24px; color: #3498db; margin-right: 10px;">king_bed</span>
                            <h3 style="margin: 0; color: #2c3e50;">房型展示設定</h3>
                        </div>
                        <div style="background-color: #d1fae5; padding: 12px; border-radius: 8px; margin-bottom: 20px;">
                            <p style="margin: 0; color: #059669; font-size: 14px;">
                                <strong>💡 提示：</strong>房型名稱、圖片、價格自動從「房型管理」同步。此處僅需設定各房型的<strong>展示設施</strong>和<strong>標籤</strong>即可。
                            </p>
                        </div>
                        <div id="landingRoomsContainer">
                            <p style="color: #888; text-align: center; padding: 40px 0;">
                                <span class="material-symbols-outlined" style="font-size: 48px; display: block; margin-bottom: 10px;">hourglass_empty</span>
                                載入房型資料中...
                            </p>
                        </div>
                        <button class="btn-save" onclick="saveLandingRoomFeatures()" style="margin-top: 10px;">
                            <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">save</span>
                            儲存房型展示設定
                        </button>
                    </div>

                    <!-- 客戶評價分頁 -->
                    <div id="landingTabReviewsContent" class="tab-content">
                        <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #f39c12;">
                            <span class="material-symbols-outlined" style="font-size: 24px; color: #f39c12; margin-right: 10px;">reviews</span>
                            <h3 style="margin: 0; color: #2c3e50;">客戶好評（最多 3 則）</h3>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div class="form-group">
                                <label>評價總數顯示</label>
                                <input type="text" id="landingReviewCount" placeholder="例如：500+">
                            </div>
                            <div class="form-group">
                                <label>平均評分</label>
                                <input type="text" id="landingReviewScore" placeholder="例如：4.9 / 5.0">
                            </div>
                        </div>
                        <div id="landingReviewsContainer">
                            <div class="settings-card" style="margin-bottom: 15px;" data-review="1">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">評價 1</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 100px; gap: 15px;">
                                    <div class="form-group">
                                        <label>評價者姓名</label>
                                        <input type="text" id="landingReview1Name" placeholder="例如：林小姐">
                                    </div>
                                    <div class="form-group">
                                        <label>日期</label>
                                        <input type="text" id="landingReview1Date" placeholder="例如：2026 年 1 月">
                                    </div>
                                    <div class="form-group">
                                        <label>評分</label>
                                        <input type="text" id="landingReview1Rating" placeholder="5.0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>評價內容</label>
                                    <textarea id="landingReview1Text" rows="2" placeholder="例如：環境超棒！房間乾淨舒適..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>標籤（以逗號分隔）</label>
                                    <input type="text" id="landingReview1Tags" placeholder="例如：環境優美,服務親切">
                                </div>
                            </div>
                            <div class="settings-card" style="margin-bottom: 15px;" data-review="2">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">評價 2</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 100px; gap: 15px;">
                                    <div class="form-group">
                                        <label>評價者姓名</label>
                                        <input type="text" id="landingReview2Name" placeholder="例如：陳先生">
                                    </div>
                                    <div class="form-group">
                                        <label>日期</label>
                                        <input type="text" id="landingReview2Date" placeholder="例如：2026 年 1 月">
                                    </div>
                                    <div class="form-group">
                                        <label>評分</label>
                                        <input type="text" id="landingReview2Rating" placeholder="5.0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>評價內容</label>
                                    <textarea id="landingReview2Text" rows="2" placeholder="例如：帶著狗狗一起入住，民宿很貼心..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>標籤（以逗號分隔）</label>
                                    <input type="text" id="landingReview2Tags" placeholder="例如：寵物友善,溫泉推薦">
                                </div>
                            </div>
                            <div class="settings-card" style="margin-bottom: 15px;" data-review="3">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">評價 3</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 100px; gap: 15px;">
                                    <div class="form-group">
                                        <label>評價者姓名</label>
                                        <input type="text" id="landingReview3Name" placeholder="例如：王小姐">
                                    </div>
                                    <div class="form-group">
                                        <label>日期</label>
                                        <input type="text" id="landingReview3Date" placeholder="例如：2025 年 12 月">
                                    </div>
                                    <div class="form-group">
                                        <label>評分</label>
                                        <input type="text" id="landingReview3Rating" placeholder="4.9">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>評價內容</label>
                                    <textarea id="landingReview3Text" rows="2" placeholder="例如：位置很好找，民宿主人超級熱情..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>標籤（以逗號分隔）</label>
                                    <input type="text" id="landingReview3Tags" placeholder="例如：CP值高,主人熱情">
                                </div>
                            </div>
                        </div>
                        <button class="btn-save" onclick="saveLandingSettings('reviews')" style="margin-top: 10px;">
                            <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">save</span>
                            儲存客戶評價
                        </button>
                    </div>

                    <!-- 聯絡與社群分頁 -->
                    <div id="landingTabContactContent" class="tab-content">
                        <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e74c3c;">
                            <span class="material-symbols-outlined" style="font-size: 24px; color: #e74c3c; margin-right: 10px;">location_on</span>
                            <h3 style="margin: 0; color: #2c3e50;">交通與聯絡資訊</h3>
                        </div>
                        <div class="settings-card" style="margin-top: 0;">
                            <div class="form-group">
                                <label>完整地址</label>
                                <input type="text" id="landingAddress" placeholder="例如：台灣某縣某鎮某路 123 號">
                            </div>
                            <div class="form-group">
                                <label>自行開車說明</label>
                                <input type="text" id="landingDriving" placeholder="例如：國道 3 號下交流道後約 15 分鐘">
                            </div>
                            <div class="form-group">
                                <label>大眾運輸說明</label>
                                <input type="text" id="landingTransit" placeholder="例如：火車站提供免費接駁服務（需預約）">
                            </div>
                            <div class="form-group">
                                <label>聯絡電話</label>
                                <input type="text" id="landingPhone" placeholder="例如：0912-345-678">
                            </div>
                            <div class="form-group">
                                <label>Google Maps 嵌入網址</label>
                                <input type="text" id="landingMapUrl" placeholder="https://www.google.com/maps/embed?pb=...">
                                <small>到 Google Maps 搜尋您的地址 → 分享 → 嵌入地圖 → 複製 src 網址</small>
                            </div>
                        </div>

                        <div style="margin-top: 30px;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #3498db;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #3498db; margin-right: 10px;">share</span>
                                <h3 style="margin: 0; color: #2c3e50;">社群連結</h3>
                            </div>
                            <div class="settings-card" style="margin-top: 0;">
                                <div class="form-group">
                                    <label>Facebook 粉絲專頁連結</label>
                                    <input type="text" id="landingSocialFb" placeholder="https://www.facebook.com/your-page">
                                </div>
                                <div class="form-group">
                                    <label>Instagram 連結</label>
                                    <input type="text" id="landingSocialIg" placeholder="https://www.instagram.com/your-account">
                                </div>
                                <div class="form-group">
                                    <label>LINE 官方帳號連結</label>
                                    <input type="text" id="landingSocialLine" placeholder="https://line.me/R/ti/p/...">
                                </div>
                            </div>
                        </div>

                        <button class="btn-save" onclick="saveLandingSettings('contact')" style="margin-top: 20px;">
                            <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">save</span>
                            儲存聯絡與社群
                        </button>
                    </div>

                    <!-- 廣告追蹤分頁 -->
                    <div id="landingTabTrackingContent" class="tab-content">
                        <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #1abc9c;">
                            <span class="material-symbols-outlined" style="font-size: 24px; color: #1abc9c; margin-right: 10px;">monitoring</span>
                            <h3 style="margin: 0; color: #2c3e50;">Facebook Pixel 設定</h3>
                        </div>
                        <div class="settings-card" style="margin-top: 0;">
                            <div style="background-color: #fef3cd; padding: 12px; border-radius: 8px; margin-bottom: 20px;">
                                <p style="margin: 0; color: #856404; font-size: 14px;">
                                    <strong>📌 設定說明：</strong>
                                    到 <a href="https://business.facebook.com/events_manager" target="_blank" style="color: #856404; text-decoration: underline;">Facebook 事件管理工具</a> 建立 Pixel 並取得 Pixel ID。設定後銷售頁和訂房頁會自動追蹤 PageView、Lead、Purchase 等事件。
                                </p>
                            </div>
                            <div class="form-group">
                                <label>Facebook Pixel ID</label>
                                <input type="text" id="landingFbPixelId" placeholder="例如：1234567890123456">
                                <small>15-16 位數字，可從 Facebook 事件管理工具取得</small>
                            </div>
                        </div>

                        <div style="margin-top: 30px;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #1abc9c;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #1abc9c; margin-right: 10px;">seo</span>
                                <h3 style="margin: 0; color: #2c3e50;">SEO 設定</h3>
                            </div>
                            <div class="settings-card" style="margin-top: 0;">
                                <div class="form-group">
                                    <label>頁面標題（Title）</label>
                                    <input type="text" id="landingSeoTitle" placeholder="例如：悠然山居民宿 | 遠離塵囂的完美假期">
                                    <small>顯示在瀏覽器分頁和搜尋引擎結果</small>
                                </div>
                                <div class="form-group">
                                    <label>頁面描述（Meta Description）</label>
                                    <textarea id="landingSeoDesc" rows="2" placeholder="例如：坐落於青山綠水間，提供您最舒適的住宿體驗。限時優惠中！"></textarea>
                                    <small>顯示在搜尋引擎結果中（建議 60-160 字）</small>
                                </div>
                                <div class="form-group">
                                    <label>Open Graph 分享圖片 URL</label>
                                    <input type="text" id="landingOgImage" placeholder="https://your-domain.com/images/og-image.jpg">
                                    <small>Facebook 分享時顯示的圖片（建議 1200x630）</small>
                                </div>
                            </div>
                        </div>

                        <button class="btn-save" onclick="saveLandingSettings('tracking')" style="margin-top: 20px;">
                            <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">save</span>
                            儲存廣告追蹤設定
                        </button>
                    </div>

                    <!-- 色系設定分頁 -->
                    <div id="landingTabThemeContent" class="tab-content">
                        <div style="margin-top: 0;">
                            <div style="display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #9b59b6;">
                                <span class="material-symbols-outlined" style="font-size: 24px; color: #9b59b6; margin-right: 10px;">palette</span>
                                <h3 style="margin: 0; color: #2c3e50;">銷售頁配色主題</h3>
                            </div>
                            <p style="color: #666; margin-bottom: 20px; font-size: 14px;">選擇一套配色主題，即時套用到銷售頁。選擇後請點擊下方「儲存色系設定」按鈕。</p>

                            <input type="hidden" id="landingThemeId" value="default">

                            <div id="themeCardsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">

                                <!-- 深海沉靜（預設） -->
                                <div class="theme-card selected" data-theme="default" onclick="selectTheme('default')">
                                    <div class="theme-preview">
                                        <div class="theme-preview-header" style="background: #1a3a4a;">
                                            <span style="color: #c9a962; font-weight: 600;">🌊 深海沉靜</span>
                                        </div>
                                        <div class="theme-preview-body" style="background: #f8f6f3;">
                                            <div class="theme-swatch" style="background: #1a3a4a;"></div>
                                            <div class="theme-swatch" style="background: #2d5a6e;"></div>
                                            <div class="theme-swatch" style="background: #c9a962;"></div>
                                            <div class="theme-swatch" style="background: #f8f6f3; border: 1px solid #ddd;"></div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <strong>深海沉靜</strong>
                                        <small>沉穩深青 × 典雅金色</small>
                                    </div>
                                    <div class="theme-check"><span class="material-symbols-outlined">check_circle</span></div>
                                </div>

                                <!-- 森林綠意 -->
                                <div class="theme-card" data-theme="forest" onclick="selectTheme('forest')">
                                    <div class="theme-preview">
                                        <div class="theme-preview-header" style="background: #2d5016;">
                                            <span style="color: #d4a853; font-weight: 600;">🌿 森林綠意</span>
                                        </div>
                                        <div class="theme-preview-body" style="background: #f5f7f2;">
                                            <div class="theme-swatch" style="background: #2d5016;"></div>
                                            <div class="theme-swatch" style="background: #4a7a2e;"></div>
                                            <div class="theme-swatch" style="background: #d4a853;"></div>
                                            <div class="theme-swatch" style="background: #f5f7f2; border: 1px solid #ddd;"></div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <strong>森林綠意</strong>
                                        <small>自然森綠 × 溫暖金黃</small>
                                    </div>
                                    <div class="theme-check"><span class="material-symbols-outlined">check_circle</span></div>
                                </div>

                                <!-- 山嵐灰調 -->
                                <div class="theme-card" data-theme="mountain" onclick="selectTheme('mountain')">
                                    <div class="theme-preview">
                                        <div class="theme-preview-header" style="background: #3d4f5f;">
                                            <span style="color: #e8b960; font-weight: 600;">🏔️ 山嵐灰調</span>
                                        </div>
                                        <div class="theme-preview-body" style="background: #f4f5f7;">
                                            <div class="theme-swatch" style="background: #3d4f5f;"></div>
                                            <div class="theme-swatch" style="background: #5a7186;"></div>
                                            <div class="theme-swatch" style="background: #e8b960;"></div>
                                            <div class="theme-swatch" style="background: #f4f5f7; border: 1px solid #ddd;"></div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <strong>山嵐灰調</strong>
                                        <small>沉穩灰藍 × 明亮金黃</small>
                                    </div>
                                    <div class="theme-check"><span class="material-symbols-outlined">check_circle</span></div>
                                </div>

                                <!-- 櫻花暖粉 -->
                                <div class="theme-card" data-theme="sakura" onclick="selectTheme('sakura')">
                                    <div class="theme-preview">
                                        <div class="theme-preview-header" style="background: #8b4557;">
                                            <span style="color: #f0c987; font-weight: 600;">🌸 櫻花暖粉</span>
                                        </div>
                                        <div class="theme-preview-body" style="background: #fdf6f0;">
                                            <div class="theme-swatch" style="background: #8b4557;"></div>
                                            <div class="theme-swatch" style="background: #a8637a;"></div>
                                            <div class="theme-swatch" style="background: #f0c987;"></div>
                                            <div class="theme-swatch" style="background: #fdf6f0; border: 1px solid #ddd;"></div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <strong>櫻花暖粉</strong>
                                        <small>溫暖玫紅 × 柔和金色</small>
                                    </div>
                                    <div class="theme-check"><span class="material-symbols-outlined">check_circle</span></div>
                                </div>

                                <!-- 夕陽暖橘 -->
                                <div class="theme-card" data-theme="sunset" onclick="selectTheme('sunset')">
                                    <div class="theme-preview">
                                        <div class="theme-preview-header" style="background: #5a3e2b;">
                                            <span style="color: #e8a54b; font-weight: 600;">🌅 夕陽暖橘</span>
                                        </div>
                                        <div class="theme-preview-body" style="background: #faf5ef;">
                                            <div class="theme-swatch" style="background: #5a3e2b;"></div>
                                            <div class="theme-swatch" style="background: #7d5a3f;"></div>
                                            <div class="theme-swatch" style="background: #e8a54b;"></div>
                                            <div class="theme-swatch" style="background: #faf5ef; border: 1px solid #ddd;"></div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <strong>夕陽暖橘</strong>
                                        <small>溫暖深棕 × 活力暖橘</small>
                                    </div>
                                    <div class="theme-check"><span class="material-symbols-outlined">check_circle</span></div>
                                </div>

                                <!-- 海洋藍調 -->
                                <div class="theme-card" data-theme="ocean" onclick="selectTheme('ocean')">
                                    <div class="theme-preview">
                                        <div class="theme-preview-header" style="background: #1e5799;">
                                            <span style="color: #ffd700; font-weight: 600;">🏖️ 海洋藍調</span>
                                        </div>
                                        <div class="theme-preview-body" style="background: #f0f5fa;">
                                            <div class="theme-swatch" style="background: #1e5799;"></div>
                                            <div class="theme-swatch" style="background: #3a7bc8;"></div>
                                            <div class="theme-swatch" style="background: #ffd700;"></div>
                                            <div class="theme-swatch" style="background: #f0f5fa; border: 1px solid #ddd;"></div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <strong>海洋藍調</strong>
                                        <small>清爽蔚藍 × 明亮金黃</small>
                                    </div>
                                    <div class="theme-check"><span class="material-symbols-outlined">check_circle</span></div>
                                </div>

                                <!-- 秋日暖棕 -->
                                <div class="theme-card" data-theme="autumn" onclick="selectTheme('autumn')">
                                    <div class="theme-preview">
                                        <div class="theme-preview-header" style="background: #5c4033;">
                                            <span style="color: #c9a962; font-weight: 600;">🍂 秋日暖棕</span>
                                        </div>
                                        <div class="theme-preview-body" style="background: #f9f4ef;">
                                            <div class="theme-swatch" style="background: #5c4033;"></div>
                                            <div class="theme-swatch" style="background: #7d5e50;"></div>
                                            <div class="theme-swatch" style="background: #c9a962;"></div>
                                            <div class="theme-swatch" style="background: #f9f4ef; border: 1px solid #ddd;"></div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <strong>秋日暖棕</strong>
                                        <small>復古深棕 × 典雅金色</small>
                                    </div>
                                    <div class="theme-check"><span class="material-symbols-outlined">check_circle</span></div>
                                </div>

                                <!-- 極簡黑白 -->
                                <div class="theme-card" data-theme="minimal" onclick="selectTheme('minimal')">
                                    <div class="theme-preview">
                                        <div class="theme-preview-header" style="background: #1a1a2e;">
                                            <span style="color: #e2b259; font-weight: 600;">⬛ 極簡黑白</span>
                                        </div>
                                        <div class="theme-preview-body" style="background: #f5f5f5;">
                                            <div class="theme-swatch" style="background: #1a1a2e;"></div>
                                            <div class="theme-swatch" style="background: #33334d;"></div>
                                            <div class="theme-swatch" style="background: #e2b259;"></div>
                                            <div class="theme-swatch" style="background: #f5f5f5; border: 1px solid #ddd;"></div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <strong>極簡黑白</strong>
                                        <small>現代深黑 × 奢華金色</small>
                                    </div>
                                    <div class="theme-check"><span class="material-symbols-outlined">check_circle</span></div>
                                </div>

                            </div>

                            <button class="btn-save" onclick="saveLandingTheme()" style="margin-top: 25px;">
                                <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">save</span>
                                儲存色系設定
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 資料備份管理區 -->
            <section id="backups-section" class="content-section">
                <div class="section-header">
                    <h2><span class="material-symbols-outlined" style="font-size: 28px; vertical-align: middle; margin-right: 8px;">backup</span> 資料備份管理</h2>
                    <div class="header-actions">
                        <button class="btn-primary permission-required" data-permission="backup.create" onclick="createBackup()">
                            <span class="material-symbols-outlined">add</span> 手動備份
                        </button>
                        <button class="btn-refresh" onclick="loadBackups()">
                            <span class="material-symbols-outlined">refresh</span> 重新整理
                        </button>
                    </div>
                </div>

                <!-- 備份統計 -->
                <div class="settings-card" style="margin-bottom: 20px;">
                    <h3 style="display: flex; align-items: center; gap: 10px;">
                        <span class="material-symbols-outlined">analytics</span>
                        備份統計
                    </h3>
                    <div id="backupStats" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div class="loading">載入中...</div>
                    </div>
                </div>

                <!-- 清理設定 -->
                <div class="settings-card" style="margin-bottom: 20px;">
                    <h3 style="display: flex; align-items: center; gap: 10px;">
                        <span class="material-symbols-outlined">cleaning_services</span>
                        清理舊備份
                    </h3>
                    <div style="display: flex; align-items: center; gap: 15px; margin-top: 15px;">
                        <label>保留天數：</label>
                        <input type="number" id="backupRetainDays" value="30" min="1" max="365" style="width: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <button class="btn-cancel permission-required" data-permission="backup.delete" onclick="cleanupBackups()">
                            <span class="material-symbols-outlined">delete_sweep</span> 清理
                        </button>
                    </div>
                </div>

                <!-- 備份列表 -->
                <div class="settings-card">
                    <h3 style="display: flex; align-items: center; gap: 10px;">
                        <span class="material-symbols-outlined">folder</span>
                        備份檔案列表
                    </h3>
                    <div class="table-container" style="margin-top: 15px;">
                        <table class="bookings-table">
                            <thead>
                                <tr>
                                    <th style="text-align: left;">檔案名稱</th>
                                    <th style="text-align: right;">檔案大小</th>
                                    <th style="text-align: left;">建立時間</th>
                                    <th style="text-align: center;">操作</th>
                                </tr>
                            </thead>
                            <tbody id="backupsTableBody">
                                <tr>
                                    <td colspan="4" class="loading">載入中...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 訂房詳情模態框 -->
    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>訂房詳情</h3>
                <span class="modal-close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- 詳情內容將動態載入 -->
            </div>
        </div>
    </div>

    <!-- 新增/編輯會員等級模態框 -->
    <div id="memberLevelModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="memberLevelModalTitle">新增會員等級</h3>
                <span class="modal-close" onclick="closeMemberLevelModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="memberLevelForm" onsubmit="saveMemberLevel(event)">
                    <input type="hidden" id="memberLevelId" value="">
                    <div class="form-group">
                        <label>等級名稱 <span style="color: red;">*</span></label>
                        <input type="text" id="memberLevelName" required placeholder="例如：新會員">
                        <small>會員等級的名稱</small>
                    </div>
                    <div class="form-group">
                        <label>消費金額門檻</label>
                        <div class="input-group">
                            <input type="number" id="memberLevelMinSpent" min="0" step="1000" value="0" placeholder="0">
                            <span class="input-suffix">NT$</span>
                        </div>
                        <small>達到此消費金額才能升級到此等級</small>
                    </div>
                    <div class="form-group">
                        <label>訂房次數門檻</label>
                        <input type="number" id="memberLevelMinBookings" min="0" step="1" value="0" placeholder="0">
                        <small>達到此訂房次數才能升級到此等級</small>
                    </div>
                    <div class="form-group">
                        <label>折扣百分比</label>
                        <div class="input-group">
                            <input type="number" id="memberLevelDiscount" min="0" max="100" step="0.1" value="0" placeholder="0">
                            <span class="input-suffix">%</span>
                        </div>
                        <small>此等級會員可享受的折扣百分比（例如：5 表示 5% 折扣）</small>
                    </div>
                    <div class="form-group">
                        <label>排序順序</label>
                        <input type="number" id="memberLevelDisplayOrder" min="1" step="1" value="1" placeholder="1">
                        <small>數字越小越優先顯示（等級從低到高）</small>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="memberLevelIsActive" checked style="width: 20px; height: 20px;">
                            <span>啟用此等級</span>
                        </label>
                    </div>
                    <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button type="button" class="btn-primary btn-danger" onclick="closeMemberLevelModal()">取消</button>
                        <button type="submit" class="btn-save">儲存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 新增/編輯優惠代碼模態框 -->
    <div id="promoCodeModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 id="promoCodeModalTitle">新增優惠代碼</h3>
                <span class="modal-close" onclick="closePromoCodeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="promoCodeForm" onsubmit="savePromoCode(event)">
                    <input type="hidden" id="promoCodeId" value="">
                    <div class="form-group">
                        <label>優惠代碼 <span style="color: red;">*</span></label>
                        <input type="text" id="promoCodeCode" required placeholder="例如：SUMMER2024" style="text-transform: uppercase;">
                        <small>優惠代碼（將自動轉換為大寫）</small>
                    </div>
                    <div class="form-group">
                        <label>優惠名稱 <span style="color: red;">*</span></label>
                        <input type="text" id="promoCodeName" required placeholder="例如：夏日特惠">
                        <small>優惠活動名稱</small>
                    </div>
                    <div class="form-group">
                        <label>優惠說明</label>
                        <textarea id="promoCodeDescription" rows="3" placeholder="優惠活動說明（選填）"></textarea>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>折扣類型 <span style="color: red;">*</span></label>
                            <select id="promoCodeDiscountType" required onchange="updatePromoCodeDiscountType()">
                                <option value="fixed">固定金額</option>
                                <option value="percent">百分比</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>折扣值 <span style="color: red;">*</span></label>
                            <div class="input-group">
                                <input type="number" id="promoCodeDiscountValue" required min="0" step="0.01" placeholder="0">
                                <span class="input-suffix" id="promoCodeDiscountSuffix">NT$</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="promoCodeMaxDiscountGroup" style="display: none;">
                        <label>最高折抵金額</label>
                        <div class="input-group">
                            <input type="number" id="promoCodeMaxDiscount" min="0" step="1" placeholder="無限制">
                            <span class="input-suffix">NT$</span>
                        </div>
                        <small>百分比折扣時，設定最高折抵金額上限（選填）</small>
                    </div>
                    <div class="form-group">
                        <label>最低消費金額</label>
                        <div class="input-group">
                            <input type="number" id="promoCodeMinSpend" min="0" step="100" value="0" placeholder="0">
                            <span class="input-suffix">NT$</span>
                        </div>
                        <small>使用此優惠代碼的最低消費金額（0 表示無限制）</small>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>總使用次數限制</label>
                            <input type="number" id="promoCodeTotalUsageLimit" min="0" step="1" placeholder="無限制">
                            <small>此優惠代碼的總使用次數上限（留空表示無限制）</small>
                        </div>
                        <div class="form-group">
                            <label>每人使用次數限制</label>
                            <input type="number" id="promoCodePerUserLimit" min="1" step="1" value="1" placeholder="1">
                            <small>每個客戶可使用此優惠代碼的次數</small>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>開始日期</label>
                            <input type="date" id="promoCodeStartDate" placeholder="立即生效">
                            <small>優惠代碼生效日期（留空表示立即生效）</small>
                        </div>
                        <div class="form-group">
                            <label>結束日期</label>
                            <input type="date" id="promoCodeEndDate" placeholder="永久有效">
                            <small>優惠代碼失效日期（留空表示永久有效）</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="promoCodeIsActive" checked style="width: 20px; height: 20px;">
                            <span>啟用此優惠代碼</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="promoCodeCanCombineEarlyBird" style="width: 20px; height: 20px;">
                            <span>可與早鳥優惠疊加使用</span>
                        </label>
                        <small style="color: #888; margin-top: 4px; display: block;">勾選後，此優惠代碼可與早鳥優惠同時使用（折扣會疊加計算）。不勾選則系統自動取較大的折扣。</small>
                    </div>
                    <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button type="button" class="btn-primary btn-danger" onclick="closePromoCodeModal()">取消</button>
                        <button type="submit" class="btn-save">儲存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 修改客戶資料模態框 -->
    <div id="customerEditModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>修改客戶資料</h3>
                <span class="modal-close" onclick="closeCustomerEditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="customerEditForm" onsubmit="saveCustomerEdit(event)">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="editCustomerEmail" readonly style="background-color: #f5f5f5;">
                        <small>Email 無法修改</small>
                    </div>
                    <div class="form-group">
                        <label>客戶姓名 <span style="color: red;">*</span></label>
                        <input type="text" id="editCustomerName" required>
                        <small>客戶姓名</small>
                    </div>
                    <div class="form-group">
                        <label>電話 <span style="color: red;">*</span></label>
                        <input type="text" id="editCustomerPhone" required>
                        <small>聯絡電話</small>
                    </div>
                    <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button type="button" class="btn-primary btn-danger" onclick="closeCustomerEditModal()">取消</button>
                        <button type="submit" class="btn-save">儲存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 郵件模板編輯模態框 -->
    <div id="emailTemplateModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 id="emailTemplateModalTitle">編輯郵件模板</h2>
                <button class="modal-close" id="emailTemplateModalClose">&times;</button>
            </div>
            <form id="emailTemplateForm" onsubmit="saveEmailTemplate(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label>模板名稱</label>
                        <input type="text" id="emailTemplateName" required>
                    </div>
                    <div class="form-group">
                        <label>郵件主旨</label>
                        <input type="text" id="emailTemplateSubject" required>
                    </div>
                    <div class="form-group">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <label style="margin: 0;">郵件內容</label>
                                <button type="button" id="restoreTemplateBtn" class="btn-secondary" style="padding: 5px 15px; font-size: 12px; display: flex; align-items: center; gap: 4px;" title="還原為預設範本內容" onclick="restoreEmailTemplate()">
                                    <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle;">restore</span>
                                    <span>還原郵件範本</span>
                                </button>
                            </div>
                            <div class="variable-buttons" style="display: flex; gap: 5px; flex-wrap: wrap;">
                                <button type="button" class="btn-var" onclick="insertVariable('{{guestName}}')" title="插入客戶姓名">姓名</button>
                                <button type="button" class="btn-var" onclick="insertVariable('{{bookingId}}')" title="插入訂房編號">訂房編號</button>
                                <button type="button" class="btn-var" onclick="insertVariable('{{checkInDate}}')" title="插入入住日期">入住日期</button>
                                <button type="button" class="btn-var" onclick="insertVariable('{{checkOutDate}}')" title="插入退房日期">退房日期</button>
                                <button type="button" class="btn-var" onclick="insertVariable('{{roomType}}')" title="插入房型">房型</button>
                                <button type="button" class="btn-var" onclick="insertVariable('{{finalAmount}}')" title="插入應付金額">應付金額</button>
                            </div>
                        </div>
                        <!-- HTML 編輯器 -->
                        <textarea id="emailTemplateContent" rows="25" required style="font-family: monospace; font-size: 13px; width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; line-height: 1.6;"></textarea>
                        <small style="margin-top: 10px; display: block; color: #666;">
                            💡 提示：使用上方按鈕插入變數，或直接點擊「姓名」、「訂房編號」等按鈕快速插入。
                        </small>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="emailTemplateEnabled" style="width: 20px; height: 20px;">
                            <span>啟用此模板</span>
                        </label>
                    </div>
                    
                    <!-- 入住提醒設定 -->
                    <div id="checkinReminderSettings" class="form-group" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <h3 style="margin-top: 0; font-size: 16px; color: #333;">發送時間設定</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label>入住前幾天發送</label>
                                <input type="number" id="daysBeforeCheckin" min="0" max="30" value="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label>發送時間（24小時制）</label>
                                <input type="number" id="sendHourCheckin" min="0" max="23" value="9" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>
                        
                    </div>
                    
                    <!-- 感謝入住設定 -->
                    <div id="feedbackRequestSettings" class="form-group" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <h3 style="margin-top: 0; font-size: 16px; color: #333;">發送時間設定</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label>退房後幾天發送</label>
                                <input type="number" id="daysAfterCheckout" min="0" max="30" value="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label>發送時間（24小時制）</label>
                                <input type="number" id="sendHourFeedback" min="0" max="23" value="10" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 匯款提醒設定 -->
                    <div id="paymentReminderSettings" class="form-group" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <h3 style="margin-top: 0; font-size: 16px; color: #333;">發送時間設定</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label>訂房後幾天發送（保留天數）</label>
                                <input type="number" id="daysReserved" min="1" max="30" value="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666; display: block; margin-top: 5px;">超過此天數未付款，訂房狀態將自動改為「已取消」</small>
                            </div>
                            <div>
                                <label>發送時間（24小時制）</label>
                                <input type="number" id="sendHourPaymentReminder" min="0" max="23" value="9" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 測試郵件功能 -->
                    <div class="form-group" style="background: #f0f8ff; padding: 15px; border-radius: 5px; margin-top: 20px; border: 1px solid #2C8EC4;">
                        <h3 style="margin-top: 0; font-size: 16px; color: #333; display: flex; align-items: center; gap: 8px;">
                            <span class="material-symbols-outlined" style="font-size: 20px;">mail</span>
                            測試郵件
                        </h3>
                        <p style="color: #666; font-size: 13px; margin: 8px 0 12px 0;">輸入 Email 地址以發送測試郵件，查看郵件實際效果</p>
                        <div style="display: flex; gap: 10px; align-items: flex-end;">
                            <div style="flex: 1;">
                                <label style="font-size: 13px; color: #666; margin-bottom: 5px; display: block;">Email 地址</label>
                                <input type="email" id="testEmailAddress" placeholder="example@email.com" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                            </div>
                            <button type="button" id="sendTestEmailBtn" class="btn-primary" style="padding: 8px 20px; white-space: nowrap;">
                                <span class="material-symbols-outlined" style="font-size: 18px; vertical-align: middle; margin-right: 4px;">send</span>
                                發送測試郵件
                            </button>
                        </div>
                        <div id="testEmailStatus" style="margin-top: 10px; font-size: 13px; display: none;"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn-primary">儲存</button>
                    <button type="button" class="btn-primary btn-danger" id="emailTemplateModalCancel">取消</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 新增/編輯管理員模態框 -->
    <div id="adminModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 id="adminModalTitle">新增管理員</h3>
                <span class="modal-close" onclick="closeAdminModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="adminForm" onsubmit="saveAdmin(event)">
                    <input type="hidden" id="editAdminId" value="">
                    <div class="form-group">
                        <label>帳號 <span style="color: red;">*</span></label>
                        <input type="text" id="adminUsername" required placeholder="請輸入帳號" autocomplete="off">
                        <small>帳號不可修改</small>
                    </div>
                    <div class="form-group" id="adminPasswordGroup">
                        <label>密碼 <span style="color: red;">*</span></label>
                        <input type="password" id="adminPassword" placeholder="請輸入密碼（至少6個字元）" autocomplete="new-password">
                        <small>新增時必填，編輯時留空表示不修改</small>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="adminEmail" placeholder="example@email.com">
                        <small>選填，用於接收系統通知</small>
                    </div>
                    <div class="form-group">
                        <label>角色 <span style="color: red;">*</span></label>
                        <select id="adminRoleId" required>
                            <option value="">請選擇角色</option>
                        </select>
                        <small>選擇管理員的角色決定其權限</small>
                    </div>
                    <div class="form-group">
                        <label>部門</label>
                        <input type="text" id="adminDepartment" placeholder="例如：客服部">
                        <small>選填</small>
                    </div>
                    <div class="form-group">
                        <label>電話</label>
                        <input type="text" id="adminPhone" placeholder="例如：0912345678">
                        <small>選填</small>
                    </div>
                    <div class="form-group">
                        <label>備註</label>
                        <textarea id="adminNotes" rows="3" placeholder="選填"></textarea>
                    </div>
                    <div class="form-group" id="adminIsActiveGroup" style="display: none;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="adminIsActive" checked style="width: 20px; height: 20px;">
                            <span>啟用此帳號</span>
                        </label>
                    </div>
                    <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button type="button" class="btn-primary btn-danger" onclick="closeAdminModal()">取消</button>
                        <button type="submit" class="btn-save">儲存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 新增/編輯角色模態框 -->
    <div id="roleModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="roleModalTitle">新增角色</h3>
                <span class="modal-close" onclick="closeRoleModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="roleForm" onsubmit="saveRole(event)">
                    <input type="hidden" id="editRoleId" value="">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>角色代碼 <span style="color: red;">*</span></label>
                            <input type="text" id="roleCode" required placeholder="例如：manager" pattern="[a-z_]+" title="只能使用小寫字母和底線">
                            <small>只能使用小寫字母和底線，建立後不可修改</small>
                        </div>
                        <div class="form-group">
                            <label>顯示名稱 <span style="color: red;">*</span></label>
                            <input type="text" id="roleDisplayName" required placeholder="例如：經理">
                            <small>在系統中顯示的名稱</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>描述</label>
                        <textarea id="roleDescription" rows="2" placeholder="角色的說明文字（選填）"></textarea>
                    </div>
                    
                    <!-- 權限選擇區 -->
                    <div class="form-group" style="margin-top: 20px;">
                        <label style="display: flex; justify-content: space-between; align-items: center;">
                            <span>權限設定</span>
                            <div style="display: flex; gap: 10px;">
                                <button type="button" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="selectAllPermissions()">全選</button>
                                <button type="button" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="deselectAllPermissions()">取消全選</button>
                            </div>
                        </label>
                        <div id="permissionsContainer" style="margin-top: 15px; max-height: 400px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; background: #f9f9f9;">
                            <div class="loading">載入權限列表中...</div>
                        </div>
                    </div>
                    
                    <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button type="button" class="btn-primary btn-danger" onclick="closeRoleModal()">取消</button>
                        <button type="submit" class="btn-save">儲存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 重設密碼模態框 -->
    <div id="resetPasswordModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>重設密碼</h3>
                <span class="modal-close" onclick="closeResetPasswordModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="resetPasswordForm" onsubmit="resetAdminPassword(event)">
                    <input type="hidden" id="resetPasswordAdminId" value="">
                    <p id="resetPasswordInfo" style="margin-bottom: 15px; color: #666;"></p>
                    <div class="form-group">
                        <label>新密碼 <span style="color: red;">*</span></label>
                        <input type="password" id="newAdminPassword" required placeholder="請輸入新密碼（至少6個字元）" minlength="6" autocomplete="new-password">
                    </div>
                    <div class="form-group">
                        <label>確認新密碼 <span style="color: red;">*</span></label>
                        <input type="password" id="confirmNewAdminPassword" required placeholder="請再次輸入新密碼" minlength="6" autocomplete="new-password">
                    </div>
                    <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button type="button" class="btn-primary btn-danger" onclick="closeResetPasswordModal()">取消</button>
                        <button type="submit" class="btn-save">重設密碼</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="admin.js?v=20260115-34" 
            onload="console.log('✅ admin.js 腳本 onload 事件觸發'); this.dataset.loaded = 'true'; if (typeof window.handleLogin === 'function') { console.log('✅ handleLogin 函數在 onload 時已可用'); } else { console.error('❌ handleLogin 函數在 onload 時仍不可用'); }"
            onerror="console.error('❌ admin.js 腳本載入失敗'); const loginPage = document.getElementById('loginPage'); if (loginPage) { loginPage.style.display = 'flex'; loginPage.style.visibility = 'visible'; }">
    </script>
    <!-- 備用初始化：確保即使 admin.js 載入失敗也能顯示登入頁 -->
    <script>
        // 備用登入函數（如果 admin.js 載入失敗）
        if (typeof window.handleLogin === 'undefined') {
            window.handleLogin = async function handleLogin(event) {
                if (event && typeof event.preventDefault === 'function') {
                    event.preventDefault();
                }
                
                console.log('🔐 [備用] 開始處理登入...');
                
                const username = document.getElementById('loginUsername')?.value;
                const password = document.getElementById('loginPassword')?.value;
                const errorDiv = document.getElementById('loginError');
                
                if (!username || !password) {
                    if (errorDiv) {
                        errorDiv.textContent = '請輸入帳號和密碼';
                        errorDiv.style.display = 'block';
                    }
                    return;
                }
                
                if (errorDiv) {
                    errorDiv.style.display = 'none';
                    errorDiv.textContent = '';
                }
                
                const submitBtn = document.querySelector('#loginForm button[type="submit"]');
                const originalBtnText = submitBtn?.textContent;
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = '登入中...';
                }
                
                try {
                    console.log('📡 [備用] 發送登入請求...');
                    let response;
                    try {
                        response = await fetch('/api/admin/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            credentials: 'include',
                            body: JSON.stringify({ username, password })
                        });
                    } catch (fetchError) {
                        console.error('❌ [備用] Fetch 請求失敗:', fetchError);
                        let errorMessage = '無法連接到伺服器';
                        if (fetchError.message.includes('Failed to fetch')) {
                            errorMessage = '無法連接到伺服器，請檢查網路連線或伺服器狀態';
                        } else if (fetchError.message.includes('NetworkError')) {
                            errorMessage = '網路錯誤，請檢查網路連線';
                        }
                        if (errorDiv) {
                            errorDiv.textContent = errorMessage;
                            errorDiv.style.display = 'block';
                        }
                        throw fetchError;
                    }
                    
                    console.log('📥 [備用] 收到回應:', response.status, response.statusText);
                    
                    let result;
                    try {
                        result = await response.json();
                    } catch (parseError) {
                        console.error('❌ [備用] 無法解析回應:', parseError);
                        const text = await response.text();
                        console.error('❌ [備用] 回應內容:', text);
                        if (errorDiv) {
                            errorDiv.textContent = '伺服器回應格式錯誤，請重新整理頁面';
                            errorDiv.style.display = 'block';
                        }
                        return;
                    }
                    
                    if (result.success) {
                        console.log('✅ [備用] 登入成功');
                        const adminPage = document.getElementById('adminPage');
                        const loginPage = document.getElementById('loginPage');
                        if (adminPage) {
                            adminPage.style.display = 'flex';
                            adminPage.style.visibility = 'visible';
                            adminPage.style.opacity = '1';
                        }
                        if (loginPage) {
                            loginPage.style.display = 'none';
                        }
                        // 重新載入頁面以載入完整的 admin.js
                        window.location.reload();
                    } else {
                        if (errorDiv) {
                            errorDiv.textContent = result.message || '登入失敗，請檢查帳號密碼';
                            errorDiv.style.display = 'block';
                        }
                    }
                } catch (error) {
                    console.error('❌ [備用] 登入錯誤:', error);
                    console.error('錯誤類型:', error.name);
                    console.error('錯誤訊息:', error.message);
                    if (errorDiv) {
                        let errorMessage = '登入時發生錯誤：' + (error.message || '請稍後再試');
                        if (error.message && error.message.includes('Failed to fetch')) {
                            errorMessage = '無法連接到伺服器，請檢查網路連線或伺服器狀態';
                        }
                        errorDiv.textContent = errorMessage;
                        errorDiv.style.display = 'block';
                    }
                } finally {
                    if (submitBtn) {
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalBtnText || '登入';
                    }
                }
            };
            console.log('✅ [備用] handleLogin 函數已設置');
        }
        
        // 如果 admin.js 載入失敗，至少顯示登入頁
        window.addEventListener('error', function(e) {
            if (e.filename && e.filename.includes('admin.js')) {
                console.error('❌ admin.js 執行錯誤:', e.message, '位置:', e.filename, ':', e.lineno);
                const loginPage = document.getElementById('loginPage');
                const adminPage = document.getElementById('adminPage');
                if (loginPage) {
                    loginPage.style.display = 'flex';
                    loginPage.style.visibility = 'visible';
                }
                if (adminPage) {
                    adminPage.style.display = 'none';
                    adminPage.style.visibility = 'hidden';
                }
            }
        }, true);
        
        // 確保 DOMContentLoaded 時至少顯示登入頁
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(function() {
                    const loginPage = document.getElementById('loginPage');
                    const adminPage = document.getElementById('adminPage');
                    if (loginPage && window.getComputedStyle(loginPage).display === 'none' && 
                        adminPage && window.getComputedStyle(adminPage).display === 'none') {
                        console.warn('⚠️ 兩個頁面都隱藏，強制顯示登入頁');
                        loginPage.style.display = 'flex';
                        loginPage.style.visibility = 'visible';
                    }
                }, 1000);
            });
        }
        
        // 確保登入表單有事件監聽器（備用方案）
        // 使用多種方式確保事件監聽器正確設置
        function setupLoginFormListener() {
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                // 移除原本的 onsubmit 屬性，改用 addEventListener（更可靠）
                loginForm.onsubmit = null;
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    // 直接調用 window.handleLogin，讓預先聲明的函數處理等待邏輯
                    if (typeof window.handleLogin === 'function') {
                        try {
                            window.handleLogin(e);
                        } catch (error) {
                            console.error('❌ 調用 handleLogin 時發生錯誤:', error);
                            const errorDiv = document.getElementById('loginError');
                            if (errorDiv) {
                                errorDiv.textContent = '登入時發生錯誤：' + (error.message || '請稍後再試');
                                errorDiv.style.display = 'block';
                            }
                        }
                    } else {
                        console.error('❌ handleLogin 函數不存在！');
                        const errorDiv = document.getElementById('loginError');
                        if (errorDiv) {
                            errorDiv.textContent = '系統錯誤：登入功能無法使用，請重新整理頁面';
                            errorDiv.style.display = 'block';
                        }
                    }
                });
                console.log('✅ 登入表單事件監聽器已設定');
                return true;
            }
            return false;
        }
        
        function showLoginError() {
            const errorDiv = document.getElementById('loginError');
            if (errorDiv) {
                errorDiv.textContent = '系統錯誤：登入功能無法使用，請重新整理頁面';
                errorDiv.style.display = 'block';
            }
        }
        
        // 確保 admin.js 已載入後再設置事件監聽器
        function waitForAdminJS(callback, maxAttempts = 50) {
            let attempts = 0;
            function check() {
                attempts++;
                // 檢查 handleLogin 是否存在
                // 同時檢查 admin.js 腳本標籤是否已載入
                const adminScript = document.querySelector('script[src*="admin.js"]');
                const scriptLoaded = adminScript && (adminScript.dataset.loaded === 'true' || adminScript.textContent.length > 0);
                
                // 檢查 window.handleLogin 是否為函數（不是 undefined）
                if (typeof window.handleLogin === 'function') {
                    // 確認不是佔位符函數
                    const fnString = window.handleLogin.toString();
                    if (!fnString.includes('尚未載入') && !fnString.includes('功能載入中')) {
                        console.log('✅ admin.js 已載入，handleLogin 函數可用', {
                            attempts: attempts,
                            fnType: typeof window.handleLogin,
                            fnLength: fnString.length
                        });
                        callback();
                        return;
                    }
                }
                
                if (attempts < maxAttempts) {
                    // 繼續等待
                    if (attempts % 10 === 0) {
                        console.log(`⏳ 等待 admin.js 載入... (${attempts}/${maxAttempts})`, {
                            scriptExists: !!adminScript,
                            scriptLoaded: scriptLoaded,
                            windowHandleLogin: typeof window.handleLogin,
                            scriptSrc: adminScript ? adminScript.src : 'N/A'
                        });
                    }
                    setTimeout(check, 100);
                } else {
                    console.error('❌ admin.js 載入超時，handleLogin 函數仍未可用', {
                        scriptExists: !!adminScript,
                        scriptLoaded: scriptLoaded,
                        windowHandleLogin: typeof window.handleLogin,
                        scriptSrc: adminScript ? adminScript.src : 'N/A'
                    });
                    // 即使超時也嘗試設置事件監聽器，但會顯示錯誤訊息
                    callback();
                }
            }
            check();
        }
        
        // 監聽 admin.js 腳本載入完成事件
        window.addEventListener('load', function() {
            const adminScript = document.querySelector('script[src*="admin.js"]');
            if (adminScript) {
                adminScript.dataset.loaded = 'true';
                console.log('✅ admin.js 腳本標籤載入完成');
            }
        });
        
        // 設置事件監聽器
        function setupListener() {
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    waitForAdminJS(function() {
                        setupLoginFormListener();
                    });
                });
            } else {
                // DOM 已經準備好
                waitForAdminJS(function() {
                    setupLoginFormListener();
                });
            }
        }
        
        // 立即開始設置
        setupListener();
    </script>
</body>
</html>

