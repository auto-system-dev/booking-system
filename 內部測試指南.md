# 內部測試指南

## 📋 測試目標

本指南旨在幫助團隊進行系統內部測試，確保所有功能正常運作，並發現潛在問題。

**測試範圍：**
- ✅ 前台訂房功能
- ✅ 管理後台功能
- ✅ API 端點
- ✅ 安全性功能
- ✅ 法規合規功能
- ✅ 資料保護功能

---

## 🚀 測試環境準備

### 1. 本地測試環境

#### 前置需求
- ✅ Node.js 已安裝
- ✅ 專案依賴已安裝（`npm install`）
- ✅ 環境變數已設定（`.env` 檔案）

#### 啟動伺服器
```powershell
# 在專案目錄下執行
node server.js
```

#### 確認伺服器運行
- 前台：http://localhost:3000
- 管理後台：http://localhost:3000/admin
- API 測試：http://localhost:3000/api/bookings

### 2. Railway 測試環境

#### 確認部署狀態
- ✅ 確認 Railway 部署成功
- ✅ 確認環境變數已設定：
  - `SESSION_SECRET`
  - `NODE_ENV=production`
  - `DATABASE_URL`（PostgreSQL）
  - Email 相關設定（SMTP 或 Gmail API）

#### 訪問網址
- 前台：`https://your-app.railway.app`
- 管理後台：`https://your-app.railway.app/admin`
- 隱私權政策：`https://your-app.railway.app/privacy`
- 個資保護：`https://your-app.railway.app/data-protection`

---

## 📝 測試項目清單

### 第一部分：前台訂房功能測試

#### 1.1 基本訂房流程 ✅

**測試步驟：**
1. [ ] 訪問前台首頁
2. [ ] 選擇入住日期和退房日期
3. [ ] 選擇房型（確認價格正確顯示）
4. [ ] 填寫客戶資訊：
   - [ ] 姓名（必填）
   - [ ] 電話（必填，格式驗證）
   - [ ] Email（必填，格式驗證）
5. [ ] 選擇人數（大人/孩童）
6. [ ] 選擇加購商品（可選）
7. [ ] 選擇付款方式（匯款/刷卡）
8. [ ] 確認訂房資訊
9. [ ] 提交訂房

**預期結果：**
- ✅ 日期選擇器正常運作
- ✅ 價格計算正確（平日/假日）
- ✅ 表單驗證正常（必填欄位、格式驗證）
- ✅ 訂房成功後顯示確認訊息
- ✅ 收到訂房確認 Email

**測試記錄：**
```
測試日期：____/____/____
測試人員：___________
測試結果：✅ 通過 / ❌ 失敗
備註：________________________________
```

#### 1.2 日期選擇驗證 ✅

**測試步驟：**
1. [ ] 嘗試選擇過去的日期（應被禁用）
2. [ ] 嘗試選擇退房日期早於入住日期（應被阻止）
3. [ ] 選擇跨週末的日期（確認假日價格計算）
4. [ ] 選擇跨假日的日期（確認假日價格計算）

**預期結果：**
- ✅ 過去日期無法選擇
- ✅ 退房日期不能早於入住日期
- ✅ 假日價格正確計算
- ✅ 價格顯示正確

#### 1.3 表單驗證 ✅

**測試步驟：**
1. [ ] 不填寫必填欄位，嘗試提交
2. [ ] 填寫錯誤格式的電話號碼
3. [ ] 填寫錯誤格式的 Email
4. [ ] 填寫正確格式的所有欄位

**預期結果：**
- ✅ 必填欄位驗證正常
- ✅ 電話格式驗證正常（台灣手機號碼格式）
- ✅ Email 格式驗證正常
- ✅ 正確格式可以成功提交

#### 1.4 價格計算 ✅

**測試步驟：**
1. [ ] 選擇平日日期（確認平日價格）
2. [ ] 選擇假日日期（確認假日價格）
3. [ ] 選擇加購商品（確認加購金額加入總額）
4. [ ] 確認總金額計算正確

**預期結果：**
- ✅ 平日價格正確
- ✅ 假日價格正確
- ✅ 加購商品金額正確加入
- ✅ 總金額計算正確

---

### 第二部分：管理後台功能測試

#### 2.1 登入系統 ✅

**測試步驟：**
1. [ ] 訪問 `/admin`（應重導向到登入頁面）
2. [ ] 輸入錯誤的帳號密碼
3. [ ] 輸入正確的帳號密碼
4. [ ] 確認登入成功
5. [ ] 確認 Session 正常（重新整理頁面仍保持登入）
6. [ ] 測試登出功能

**預期結果：**
- ✅ 未登入無法訪問後台
- ✅ 錯誤帳密顯示錯誤訊息
- ✅ 正確帳密成功登入
- ✅ Session 24 小時內有效
- ✅ 登出功能正常

**測試記錄：**
```
測試日期：____/____/____
測試人員：___________
帳號：___________
測試結果：✅ 通過 / ❌ 失敗
備註：________________________________
```

#### 2.2 訂房記錄管理 ✅

**測試步驟：**
1. [ ] 查看訂房記錄列表
2. [ ] 使用搜尋功能（搜尋姓名、Email、電話、訂房編號）
3. [ ] 使用房型篩選
4. [ ] 使用狀態篩選
5. [ ] 查看訂房詳情
6. [ ] 編輯訂房記錄
7. [ ] 取消訂房記錄
8. [ ] 確認分頁功能正常

**預期結果：**
- ✅ 列表正常顯示所有訂房記錄
- ✅ 搜尋功能正常運作
- ✅ 篩選功能正常運作
- ✅ 詳情顯示完整資訊
- ✅ 編輯功能正常
- ✅ 取消功能正常
- ✅ 分頁功能正常

#### 2.3 日曆視圖 ✅

**測試步驟：**
1. [ ] 切換到日曆視圖
2. [ ] 確認訂房記錄正確顯示在日曆上
3. [ ] 點擊空白格新增訂房
4. [ ] 點擊已有訂房查看詳情
5. [ ] 切換週次（上一週/下一週）

**預期結果：**
- ✅ 日曆正確顯示訂房記錄
- ✅ 快速新增功能正常
- ✅ 週次切換正常
- ✅ 訂房詳情顯示正確

#### 2.4 統計資料 ✅

**測試步驟：**
1. [ ] 查看統計資料頁面
2. [ ] 確認總訂房數正確
3. [ ] 確認總營收正確
4. [ ] 確認近7天訂房數正確
5. [ ] 確認房型統計正確
6. [ ] 確認客戶統計正確

**預期結果：**
- ✅ 所有統計資料正確
- ✅ 資料即時更新
- ✅ 圖表正常顯示（如有）

---

### 第三部分：房型管理測試

#### 3.1 房型新增 ✅

**測試步驟：**
1. [ ] 進入房型管理頁面
2. [ ] 點擊「新增房型」
3. [ ] 填寫房型資訊：
   - [ ] 房型名稱
   - [ ] 平日價格
   - [ ] 假日價格
   - [ ] 人數限制
   - [ ] 加床人數
4. [ ] 提交新增
5. [ ] 確認房型出現在列表中

**預期結果：**
- ✅ 新增表單正常顯示
- ✅ 表單驗證正常
- ✅ 新增成功
- ✅ 房型出現在列表中

#### 3.2 房型編輯 ✅

**測試步驟：**
1. [ ] 選擇一個房型
2. [ ] 點擊「編輯」
3. [ ] 修改房型資訊
4. [ ] 提交修改
5. [ ] 確認修改成功

**預期結果：**
- ✅ 編輯表單正常顯示
- ✅ 修改成功
- ✅ 修改後的資訊正確顯示

#### 3.3 房型刪除 ✅

**測試步驟：**
1. [ ] 選擇一個房型
2. [ ] 點擊「刪除」
3. [ ] 確認刪除操作
4. [ ] 確認房型從列表中移除

**預期結果：**
- ✅ 刪除確認對話框正常顯示
- ✅ 刪除成功
- ✅ 房型從列表中移除

---

### 第四部分：基本設定測試

#### 4.1 系統設定 ✅

**測試步驟：**
1. [ ] 進入系統設定頁面
2. [ ] 修改匯款資訊
3. [ ] 修改 Email 設定
4. [ ] 修改訂金百分比
5. [ ] 提交修改
6. [ ] 確認設定已保存

**預期結果：**
- ✅ 設定頁面正常顯示
- ✅ 修改成功
- ✅ 設定正確保存
- ✅ 新設定在訂房流程中生效

#### 4.2 假日設定 ✅

**測試步驟：**
1. [ ] 進入假日設定頁面
2. [ ] 新增假日
3. [ ] 確認假日出現在列表中
4. [ ] 刪除假日
5. [ ] 確認假日從列表中移除

**預期結果：**
- ✅ 新增假日成功
- ✅ 假日列表正確顯示
- ✅ 刪除假日成功
- ✅ 假日價格在訂房時正確計算

#### 4.3 加購商品管理 ✅

**測試步驟：**
1. [ ] 進入加購商品管理頁面
2. [ ] 新增加購商品
3. [ ] 編輯加購商品
4. [ ] 刪除加購商品
5. [ ] 確認加購商品在訂房流程中顯示

**預期結果：**
- ✅ 新增/編輯/刪除功能正常
- ✅ 加購商品在訂房流程中正確顯示
- ✅ 加購商品價格正確計算

---

### 第五部分：Email 通知測試

#### 5.1 訂房確認 Email ✅

**測試步驟：**
1. [ ] 完成一筆訂房
2. [ ] 確認收到訂房確認 Email
3. [ ] 檢查 Email 內容：
   - [ ] 訂房編號正確
   - [ ] 客戶資訊正確
   - [ ] 訂房詳情正確
   - [ ] 匯款資訊正確（如選擇匯款）

**預期結果：**
- ✅ Email 成功發送
- ✅ Email 內容正確
- ✅ Email 格式美觀

#### 5.2 匯款提醒 Email ✅

**測試步驟：**
1. [ ] 建立一筆匯款訂房
2. [ ] 等待匯款提醒時間（或手動觸發）
3. [ ] 確認收到匯款提醒 Email

**預期結果：**
- ✅ 匯款提醒 Email 成功發送
- ✅ Email 內容包含匯款資訊

#### 5.3 入住提醒 Email ✅

**測試步驟：**
1. [ ] 建立一筆訂房（入住日期為明天）
2. [ ] 等待入住提醒時間（或手動觸發）
3. [ ] 確認收到入住提醒 Email

**預期結果：**
- ✅ 入住提醒 Email 成功發送
- ✅ Email 內容包含入住資訊

#### 5.4 取消通知 Email ✅

**測試步驟：**
1. [ ] 建立一筆訂房
2. [ ] 取消該訂房
3. [ ] 確認收到取消通知 Email

**預期結果：**
- ✅ 取消通知 Email 成功發送
- ✅ Email 內容包含取消資訊

---

### 第六部分：安全性功能測試

#### 6.1 API Rate Limiting ✅

**測試步驟：**
1. [ ] 快速發送多個登入請求（超過 5 次/15 分鐘）
2. [ ] 確認收到 Rate Limit 錯誤
3. [ ] 等待 15 分鐘後再次嘗試
4. [ ] 確認可以正常登入

**預期結果：**
- ✅ Rate Limiting 正常運作
- ✅ 錯誤訊息清楚
- ✅ 限制時間過後可以正常使用

#### 6.2 CSRF 保護 ✅

**測試步驟：**
1. [ ] 嘗試不帶 CSRF Token 提交訂房表單
2. [ ] 確認收到 CSRF 錯誤
3. [ ] 帶正確的 CSRF Token 提交
4. [ ] 確認提交成功

**預期結果：**
- ✅ CSRF Token 驗證正常
- ✅ 無 Token 的請求被拒絕
- ✅ 正確 Token 的請求成功

#### 6.3 輸入驗證 ✅

**測試步驟：**
1. [ ] 嘗試 SQL Injection 攻擊（例如：`' OR '1'='1`）
2. [ ] 嘗試 XSS 攻擊（例如：`<script>alert('XSS')</script>`）
3. [ ] 確認攻擊被阻止
4. [ ] 確認輸入被正確清理

**預期結果：**
- ✅ SQL Injection 被阻止
- ✅ XSS 攻擊被阻止
- ✅ 輸入被正確清理和轉義

#### 6.4 Session 管理 ✅

**測試步驟：**
1. [ ] 登入後確認 Session Cookie 已設定
2. [ ] 確認 Session Cookie 為 HttpOnly
3. [ ] 確認 Session Cookie 為 Secure（生產環境）
4. [ ] 登出後確認 Session 被清除

**預期結果：**
- ✅ Session Cookie 正確設定
- ✅ Cookie 安全性設定正確
- ✅ 登出後 Session 被清除

---

### 第七部分：法規合規功能測試

#### 7.1 隱私權政策頁面 ✅

**測試步驟：**
1. [ ] 訪問 `/privacy`
2. [ ] 確認隱私權政策內容完整
3. [ ] 確認頁面設計美觀
4. [ ] 確認響應式設計正常

**預期結果：**
- ✅ 隱私權政策頁面正常顯示
- ✅ 內容完整且符合法規
- ✅ 頁面設計美觀

#### 7.2 Cookie 同意機制 ✅

**測試步驟：**
1. [ ] 首次訪問前台首頁
2. [ ] 確認 Cookie 同意橫幅顯示
3. [ ] 點擊「接受」
4. [ ] 確認橫幅消失
5. [ ] 重新整理頁面，確認橫幅不再顯示
6. [ ] 清除瀏覽器資料
7. [ ] 再次訪問，確認橫幅重新顯示

**預期結果：**
- ✅ Cookie 同意橫幅正常顯示
- ✅ 接受後橫幅消失
- ✅ 選擇被記住（localStorage）
- ✅ 清除資料後重新顯示

#### 7.3 個資保護功能 ✅

**測試步驟：**
1. [ ] 訪問 `/data-protection`
2. [ ] 測試個資查詢功能：
   - [ ] 輸入 Email
   - [ ] 發送驗證碼
   - [ ] 確認收到驗證碼 Email
   - [ ] 輸入驗證碼
   - [ ] 確認顯示個資
3. [ ] 測試個資刪除功能：
   - [ ] 輸入 Email
   - [ ] 發送驗證碼
   - [ ] 輸入驗證碼
   - [ ] 確認刪除操作
   - [ ] 確認個資被匿名化

**預期結果：**
- ✅ 個資保護頁面正常顯示
- ✅ Email 驗證碼正常發送
- ✅ 個資查詢功能正常
- ✅ 個資刪除功能正常
- ✅ 個資被正確匿名化

---

### 第八部分：資料保護功能測試

#### 8.1 資料庫備份 ✅

**測試步驟：**
1. [ ] 手動觸發備份（或等待自動備份）
2. [ ] 確認備份檔案已建立
3. [ ] 確認備份檔案名稱正確（包含日期時間）
4. [ ] 確認備份檔案大小合理
5. [ ] 查看備份列表 API

**預期結果：**
- ✅ 備份成功建立
- ✅ 備份檔案格式正確
- ✅ 備份列表正確顯示

#### 8.2 操作日誌記錄 ✅

**測試步驟：**
1. [ ] 執行各種管理操作（登入、新增訂房、編輯房型等）
2. [ ] 查看操作日誌 API
3. [ ] 確認所有操作都被記錄
4. [ ] 確認日誌包含正確資訊（操作者、時間、操作類型等）

**預期結果：**
- ✅ 所有操作都被記錄
- ✅ 日誌資訊完整
- ✅ 日誌查詢功能正常

#### 8.3 自動取消未付款訂房 ✅

**測試步驟：**
1. [ ] 建立一筆「保留」狀態的訂房
2. [ ] 等待自動取消時間（或手動觸發 Cron Job）
3. [ ] 確認訂房狀態變為「已取消」
4. [ ] 確認收到取消通知 Email

**預期結果：**
- ✅ 自動取消功能正常運作
- ✅ 訂房狀態正確更新
- ✅ 取消通知 Email 成功發送

---

## 🐛 常見問題排查

### 問題 1：無法登入管理後台

**可能原因：**
- Session Secret 未設定
- Cookie 設定問題
- 環境變數未正確設定

**解決方法：**
1. 確認 `SESSION_SECRET` 環境變數已設定
2. 確認 `NODE_ENV=production`（Railway）
3. 清除瀏覽器 Cookie 後重試
4. 查看伺服器日誌確認錯誤訊息

### 問題 2：Email 無法發送

**可能原因：**
- SMTP 設定錯誤
- Gmail API 憑證問題
- Railway SMTP 連接超時

**解決方法：**
1. 確認 Email 相關環境變數已設定
2. 確認 Gmail API 憑證正確
3. 查看伺服器日誌確認錯誤訊息
4. 系統會自動使用 Gmail API 備用方案

### 問題 3：訂房表單提交失敗

**可能原因：**
- CSRF Token 未正確設定
- 輸入驗證失敗
- API Rate Limiting

**解決方法：**
1. 確認 CSRF Token 已正確取得
2. 檢查表單輸入是否符合驗證規則
3. 確認未超過 Rate Limit
4. 查看瀏覽器控制台錯誤訊息

### 問題 4：資料庫連接失敗

**可能原因：**
- `DATABASE_URL` 未設定
- PostgreSQL 連接字串錯誤
- 資料庫服務未啟動

**解決方法：**
1. 確認 `DATABASE_URL` 環境變數已設定
2. 確認連接字串格式正確
3. 確認資料庫服務正在運行
4. 查看伺服器日誌確認錯誤訊息

---

## 📊 測試記錄模板

### 測試記錄表

```
測試日期：____/____/____
測試人員：___________
測試環境：□ 本地 / □ Railway
測試範圍：________________________________

測試項目：
□ 前台訂房功能
□ 管理後台功能
□ 房型管理
□ 基本設定
□ Email 通知
□ 安全性功能
□ 法規合規功能
□ 資料保護功能

測試結果：
✅ 通過項目：____ 項
❌ 失敗項目：____ 項
⚠️  需改進項目：____ 項

發現的問題：
1. ________________________________
2. ________________________________
3. ________________________________

建議改進：
1. ________________________________
2. ________________________________
3. ________________________________

測試人員簽名：___________
```

---

## ✅ 測試完成檢查清單

完成所有測試後，確認以下項目：

- [ ] 所有核心功能測試完成
- [ ] 所有安全性功能測試完成
- [ ] 所有法規合規功能測試完成
- [ ] 所有發現的問題已記錄
- [ ] 所有問題已回報給開發團隊
- [ ] 測試記錄已填寫完整
- [ ] 測試報告已提交

---

## 🎯 測試優先順序

### 第一優先（必須完成）
1. ✅ 前台訂房功能
2. ✅ 管理後台登入系統
3. ✅ 訂房記錄管理
4. ✅ Email 通知

### 第二優先（建議完成）
5. ✅ 安全性功能
6. ✅ 法規合規功能
7. ✅ 資料保護功能

### 第三優先（可選）
8. ✅ 統計資料
9. ✅ 日曆視圖
10. ✅ 客戶管理

---

## 📝 測試報告範例

```
# 內部測試報告

**測試日期：** 2024/01/15
**測試人員：** 張三
**測試環境：** Railway 生產環境

## 測試結果摘要

- **總測試項目：** 50 項
- **通過項目：** 48 項 ✅
- **失敗項目：** 2 項 ❌
- **通過率：** 96%

## 發現的問題

### 問題 1：Email 發送延遲
**嚴重程度：** 中
**描述：** 部分 Email 發送有 5-10 秒延遲
**建議：** 優化 Email 發送邏輯

### 問題 2：日曆視圖載入較慢
**嚴重程度：** 低
**描述：** 當訂房記錄超過 100 筆時，日曆視圖載入較慢
**建議：** 實作分頁或虛擬滾動

## 建議改進

1. 優化 Email 發送效能
2. 實作日曆視圖分頁
3. 加強錯誤訊息提示

## 結論

系統整體功能正常，可以進入 Beta 測試階段。
```

---

## 🚀 下一步行動

完成內部測試後：

1. **修復發現的問題**
   - 優先處理高嚴重程度的問題
   - 記錄所有修復內容

2. **準備 Beta 測試**
   - 邀請少量真實用戶參與測試
   - 收集用戶回饋

3. **持續監控**
   - 監控系統日誌
   - 監控錯誤率
   - 監控效能指標

---

**祝測試順利！** 🎉

